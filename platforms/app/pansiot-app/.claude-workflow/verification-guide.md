# 移动端项目启动与验证指南

## 环境准备

### 前置要求
- Node.js 16+ (推荐 v18 或 v20)
- npm 或 pnpm
- 浏览器 (H5 验证)
- 微信开发者工具 (小程序验证,可选)

---

## 启动步骤

### 1. 安装依赖

```bash
# 进入项目目录
cd platforms/app/pansiot-app

# 安装依赖
npm install
```

**预期结果**:
- 下载并安装所有依赖包
- 生成 node_modules 目录
- 无安装错误

---

### 2. 启动 H5 开发服务器

```bash
# H5 模式启动
npm run dev:h5
```

**预期结果**:
- Vite 开发服务器启动
- 控制台输出服务器地址 (通常是 http://localhost:5173)
- 自动打开浏览器或手动访问该地址

---

### 3. 启动微信小程序 (可选)

```bash
# 微信小程序模式启动
npm run dev:mp-weixin
```

**预期结果**:
- 编译生成 dist/dev/mp-weixin 目录
- 使用微信开发者工具打开该目录

---

### 4. 启动 App (可选)

```bash
# App 模式启动
npm run dev:app
```

**预期结果**:
- 需要使用 HBuilderX 打开项目
- 连接真机或模拟器运行

---

## 手动验证清单

### ✅ 基础功能验证

#### 1. 启动页验证
- [ ] 页面正常显示
- [ ] Logo 图片正常加载
- [ ] 应用名称 "PansIot" 显示正常
- [ ] 副标题 "工业物联网移动平台" 显示正常
- [ ] 版本号 "版本 1.0.0" 显示正常
- [ ] 2秒后自动跳转到登录页

**验证方法**:
1. 访问 http://localhost:5173
2. 观察启动页显示
3. 等待2秒,检查自动跳转

---

#### 2. 登录页验证

**UI 验证**:
- [ ] Logo 图片显示正常
- [ ] 应用标题显示正常
- [ ] 用户名/手机号输入框显示
- [ ] 密码输入框显示
- [ ] "记住密码" 复选框显示
- [ ] "忘记密码?" 链接显示
- [ ] "登录" 按钮显示
- [ ] 其他登录方式 (微信图标) 显示

**功能验证**:

**2.1 表单验证**:
- [ ] 不输入用户名,点击登录 → 提示"请输入用户名/手机号"
- [ ] 输入错误格式用户名 (如: abc) → 提示"用户名/手机号格式不正确"
- [ ] 不输入密码,点击登录 → 提示"请输入密码"
- [ ] 输入错误格式密码 (如: 123) → 提示"密码格式不正确"

**2.2 登录功能 (Mock)**:
- [ ] 输入正确格式的用户名和密码
- [ ] 点击"登录"按钮
- [ ] 显示"登录中..."加载状态
- [ ] 登录成功后提示"登录成功"
- [ ] 自动跳转到工作台页面 (TabBar)

**测试账号** (Mock):
- 用户名: admin 或 任意手机号
- 密码: 任意6-20位包含字母和数字的密码 (如: admin123)

**2.3 记住密码功能**:
- [ ] 勾选"记住密码"并成功登录
- [ ] 退出后重新打开,用户名自动填充
- [ ] 记住密码状态保持

---

#### 3. TabBar 导航验证

登录成功后,验证底部导航栏:

- [ ] 显示5个 Tab: 工作台、设备、看板、消息、我的
- [ ] Tab 图标正常显示
- [ ] 点击 Tab 可切换页面
- [ ] 当前激活 Tab 高亮显示

---

#### 4. Pinia 状态管理验证

打开浏览器开发者工具 (F12):

**Application → Local Storage**:
- [ ] 登录后生成 `token` 字段
- [ ] 登录后生成 `refreshToken` 字段
- [ ] 登录后生成 `userInfo` 字段
- [ ] Token 格式: `mock-token-` + 时间戳

**Console 控制台**:
- [ ] 无 JavaScript 错误
- [ ] 无 API 请求错误 (Mock 请求正常)
- [ ] 看到 `[Request]` 和 `[Response]` 日志
- [ ] 看到 `[Mock API]` 日志

---

#### 5. 通用组件验证

虽然这些组件已在各页面中使用,但可以额外验证:

- [ ] Loading 组件: 登录时显示加载动画
- [ ] Toast 提示: 表单验证和登录结果显示
- [ ] 页面跳转: 路由切换正常

---

### 🔧 高级验证

#### 6. API Mock 验证

在 Console 控制台中:

- [ ] 输入用户名密码登录
- [ ] 查看 `[Mock API] login:` 日志
- [ ] 查看请求数据格式正确
- [ ] 查看响应数据包含:
  - token
  - refreshToken
  - expiresIn: 7200
  - user (包含 id, username, phone, roles, tenantId 等)

**依赖忽略标记验证**:

打开 `src/api/modules/auth.api.ts` 文件:
- [ ] 第5-11行有完整的 TODO(依赖) 标记
- [ ] 第16行有 `// === 依赖忽略开始 ===`
- [ ] 第140行有 `// === 依赖忽略结束 ===`

---

#### 7. 样式验证

- [ ] 全局样式正常应用
- [ ] 渐变背景色显示正常 (启动页紫色渐变)
- [ ] 按钮样式正常 (登录按钮渐变背景)
- [ ] 输入框样式正常 (圆角、灰色背景)
- [ ] 图标样式正常 (uni-icons 显示)

---

#### 8. TypeScript 类型检查验证

```bash
# 在项目根目录执行
cd platforms/app/pansiot-app
npm run lint
```

**预期结果**:
- 无 ESLint 错误
- 无 TypeScript 类型错误
- 代码格式正确

---

#### 9. 构建验证

```bash
# 构建 H5 生产版本
npm run build:h5
```

**预期结果**:
- 成功生成 `dist/build/h5` 目录
- 无构建错误
- 构建产物完整

---

## 常见问题排查

### 问题1: 依赖安装失败

**现象**: `npm install` 报错

**解决方案**:
```bash
# 清除缓存后重新安装
rm -rf node_modules package-lock.json
npm install

# 或使用 cnpm/pnpm
pnpm install
```

---

### 问题2: 端口被占用

**现象**: `Error: listen EADDRINUSE :5173`

**解决方案**:
```bash
# Windows
netstat -ano | findstr :5173
taskkill /PID <进程ID> /F

# 或修改端口
# 在 vite.config.ts 中配置 server.port
```

---

### 问题3: 页面白屏

**现象**: 浏览器显示空白页面

**排查步骤**:
1. 打开浏览器控制台 (F12)
2. 查看 Console 是否有错误
3. 查看 Network 是否有资源加载失败
4. 检查 import 路径是否正确

---

### 问题4: 登录后跳转失败

**现象**: 登录成功但不跳转

**排查步骤**:
1. 检查 `pages.json` 中是否配置了 workspace 页面
2. 检查 TabBar 配置是否正确
3. 查看 Console 是否有路由错误

---

## 验证结果记录

### ✅ 通过项
- [ ] 启动页正常
- [ ] 登录页 UI 正常
- [ ] 登录功能正常
- [ ] TabBar 导航正常
- [ ] 状态管理正常
- [ ] Mock API 正常
- [ ] 样式正常
- [ ] 无控制台错误

### ❌ 失败项
- [ ] 记录问题描述
- [ ] 记录错误信息
- [ ] 记录复现步骤

### 📝 备注
- [ ] 其他发现
- [ ] 改进建议

---

## 验收标准

### 必须通过 (P0)
- [x] 项目可正常启动
- [ ] 启动页正常显示和跳转
- [ ] 登录页 UI 完整
- [ ] 登录功能 (Mock) 正常
- [ ] 无致命错误

### 建议通过 (P1)
- [ ] TabBar 导航正常
- [ ] 状态管理正常
- [ ] 样式显示正常
- [ ] 代码质量良好

### 可选 (P2)
- [ ] 微信小程序运行正常
- [ ] 性能表现良好
- [ ] 多端兼容性良好

---

## 快速验证命令

```bash
# 1. 进入目录
cd platforms/app/pansiot-app

# 2. 安装依赖 (首次)
npm install

# 3. 启动 H5
npm run dev:h5

# 4. 访问浏览器
# http://localhost:5173

# 5. 测试登录
# 用户名: admin
# 密码: admin123
```

---

## 验证完成后的操作

### 验证通过 ✅
1. 记录验证结果
2. 更新实施日志
3. 标记 Stage 4 任务为完成
4. 准备进入下一阶段

### 验证失败 ❌
1. 记录问题清单
2. 修复相关问题
3. 重新验证
4. 更新问题跟踪

---

**文档版本**: 1.0
**创建日期**: 2026-01-28
**维护者**: Claude Code
