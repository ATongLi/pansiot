

# 云平台


## 平台功能
1. 用户权限
平台用户和权限的设计:
默认注册就是组织类型只是没有认证为企业认证而已。相当于就是默认托管了，也能够创建组织下面的账号，然后也需要验证信息。成功就在组织下面了。
也能创建子组织，把人分到组织下面，也能把设备分到组织下面。
父组织拥有所有自己创建的组织的设备信息。
如果其他人想创建自己的组织，那就自己再创建一个，设备重新添加过来。

设备的权限，就是有超级管理员，管理员，操作员权限，临时权限角色默认，也需要支持用户自定义权限。
设备添加同样走审批申请流程。 

- 注册时需要填写：账号名称、密码、绑定手机号、邮箱账号、公司名称、所属行业（默认选项、其他选项-支持用户自填）。绑定手机号，支持国际国家的支持。
- 注册账号后，默认成为组织的管理员角色，默认管理员角色，拥有所有企业下的权限。
- 注册组织后，管理员可以创建用户、角色、权限的对应关系管理，再组织管理模块。支持创建子组织。

2. 设备分配管理
- 超级管理员、管理员、操作员、访问者、自定义设备角色。
- 超级管理员不可见。
设备-》本组织-》 
设备ID -》成员--》角色ID   角色ID -》用户成员
设备用户组 
    -> 角色1
    -> 角色2
    -> 角色3 

3. 云平台账号系统
需求背景：
云平台系统需要实现多租户系统系统，平台系统本质是面向企业组织类型的租户使用。但同样还是需要注册一个账号来使用，并且企业组织是存在多人的，人归属到组织当中。
物联网平台是一个多租户平台，用户有系统集成商，然后集成商还有他的下游客户，也需要账号以及相关功能，比如设备管理。但下游客户更多时使用，日常的一些管理包括账号的创建等等都需要集成商客户来完成。这样的账号系统，以及涉及到上下游相关联的功能，例如设备管理，即要在下游客户账号能看到，还要再系统集成商账号里能看到。
。

用户场景：
平台企业组织可能是一个设备集成商的角色。集成商下游还有他的客户企业，客户本身也是一个企业组织。下游组织的组织账号、以及使用的个人账号都需要集成商帮忙创建。因为系统还需要以下几个功能点：
1. 组织实体本身除了有基础属性、类型外，还有组织的管理组织字段，也就是组织交由哪个组织来管理。上游组织（父组织）字段，用来标识上一级是说。因为集成商客户创建的子组织，会存在上下级管理。 
2. 组织账号下能创建子组织、用户。子组织同样需要企业名称。
3. 用户注册时需要输入企业组织名称，系统会默认生成一个组织，并将用户分配到系统管理员角色中。系统本身遵循RABC的方式，有系统角色、系统功能权限，需要给角色配置权限。注册组织的时候，将默认生成一个不可删除的系统管理元角色，并将注册的账号，添加到角色中，系统管理员角色默认拥有系统所有权限。权限的粒度针对到每个功能标签页、功能模块下的功能按钮，例如删除、新增、查看。
注册时支持手机号注册或邮箱注册，必填项企业名称，所属行业（默认选项、其他选项-支持用户自填）。绑定手机号，支持国际国家的支持。手机号或邮箱验证码验证。刚可以可以mock或固定验证通过。
4. 用户注册时，如果已经存在一个组织，那么勾选已有企业，那就不用填企业名称，需要填入企业下的企业序列码就会自动加入组织。企业序列号在生成企业组织账号时，将自动生成，系统全局唯一，长度不能过长，例如可以时一个日期或时间的前缀+系统自增长ID。避免被容易猜中，又不会重复。
5. 一个租户一开始可以是下游终端用户角色，后面通过开通功能切换成为

需要实现的功能:
1. 云平台的前端和后端需要实现账号注册、登录功能及页面
2. 租户系统的RABC功能。预设系统的功能有系统配置、子组织管理（增删改查）、账号（增删改查）、角色（增删改查）
3. 租户管理、账号管理、登录注销等功能的后端逻辑
4. 前端界面需简化交互，减轻用户的理解复杂度。如果不是集成商类型的账号或没开通下游客户功能租户，在相关资源创建的时候，就隐藏归属选项，并实现自动填充对应的字段。

技术方案参考：
核心设计原则，采用三层租户架构 + 租户级 RBAC 权限模型，实现权责分层（集成商管下游、下游管内部）、数据单向可视（集成商看所有下游，下游仅看自身）、跨主体严格隔离（不同集成商 / 同集成商不同下游互不可见），同时兼顾集成商的全局管控需求和下游客户的日常使用需求，所有设计围绕「集成商是一级管控主体，下游客户是二级业务主体，平台超管是根管控主体」展开。
为了实现快速的上下级关联和高效的数据查询 / 隔离，设计租户唯一标识规则，所有业务表（设备、账号、告警、日志）均有两个字段，一个是归属租户ID，一个是管理租户ID。这样在

❯ REQ-007 需要补充以下需求：
  1. 企业序列号当前的生成规则生成的长度偏长，因为会用在用户加入组织时输入。
  2. 平台后台针对租户开通功能，租户只有开通某个模块功能后才能使用，前端也才展示。
  3. 后台管理租户的功能开通时，还可以针对功能设置使用配额。例如能创建的下游子客户多少个，可创建的Web工程数量等。     
  4. 集成商客户，可针对下游终端租户开通功能，开通的功能范围是自己拥有的功能。
  5. 集成商可以将自己的功能使用配额分配给自己管理的终端租户。分配完之后自身的可使用数量就减少了。每个租户都会统计资源可使用数量和已使用数量。
  6. 集成商创建资源时，归属到终端租户时，managed_tenant_id前端自动填充为集成商自己。
  7. 系统默认的功能模块清单，且有些功能是系统默认功能。租户生成后登录就能查看和使用的。
  8. 每个租户的功能模块资源使用限制表，记录可使用量、当前使用量、剩余量等。
  9. 系统日志模块 后续平台的一些关键操作都需要有日志记录。例如业务资源对象的创建删除修改等。如何设计才能满足后续不同模块的记录需求，又能让设计的方案精简，能快速扩展出哪些要加哪些不要加。

  企业序列号生成规则，需要再精简为4位随机号+4为自增ID

