# IMP-008: 移动端 UniApp 项目初始化实施计划

## 元数据
- **实现ID**: IMP-008
- **关联方案**: SOL-008
- **关联功能**: FE-008
- **实现状态**: 进行中
- **开始日期**: 2026-01-28
- **预计完成**: 2026-02-15 (约2-3周)
- **实际完成**: 待定
- **负责人**: Claude Code

## 实现概述

基于 SOL-008 技术方案,实现移动端 UniApp 项目的完整初始化,包括项目创建、目录结构搭建、基础配置、通用组件、核心模块骨架和第一个可运行的页面。建立清晰的模块化架构,为后续功能开发奠定基础。

## 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| UniApp | 3.0+ | 跨平台框架 |
| Vue | 3.3+ | 前端框架 |
| TypeScript | 5.0+ | 开发语言 |
| Pinia | 2.1+ | 状态管理 |
| uView UI | 2.0+ | UI 组件库 |
| Vite | 4.0+ | 构建工具 |
| ESLint | 8.0+ | 代码规范 |
| Prettier | 3.0+ | 代码格式化 |

## 任务分解

### Phase 1: 项目初始化 (2-3天)

#### 1.1 创建 UniApp 项目
- [ ] Task 1.1.1: 使用 HBuilderX 创建 UniApp Vue 3 + TypeScript 项目
- [ ] Task 1.1.2: 配置项目名称和基本信息
- [ ] Task 1.1.3: 验证项目可正常运行

**预估时间**: 1小时
**负责人**: 开发团队

#### 1.2 安装和配置依赖
- [ ] Task 1.2.1: 安装 Pinia (`npm install pinia`)
- [ ] Task 1.2.2: 安装 uView UI (`npm install uview-ui`)
- [ ] Task 1.2.3: 安装开发依赖 (ESLint, Prettier, TypeScript)
- [ ] Task 1.2.4: 配置 package.json scripts

**预估时间**: 1小时
**负责人**: 开发团队

#### 1.3 配置 TypeScript
- [ ] Task 1.3.1: 配置 tsconfig.json (strict 模式)
- [ ] Task 1.3.2: 配置 Vue 类型声明
- [ ] Task 1.3.3: 配置 UniApp 类型声明

**预估时间**: 1小时
**负责人**: 开发团队

#### 1.4 配置代码规范
- [ ] Task 1.4.1: 配置 ESLint (.eslintrc.js)
- [ ] Task 1.4.2: 配置 Prettier (.prettierrc)
- [ ] Task 1.4.3: 配置 .editorconfig
- [ ] Task 1.4.4: 配置 gitignore

**预估时间**: 1小时
**负责人**: 开发团队

#### 1.5 配置 Vite
- [ ] Task 1.5.1: 配置 vite.config.ts
- [ ] Task 1.5.2: 配置路径别名 (@/ 指向 src)
- [ ] Task 1.5.3: 配置环境变量 (.env.development, .env.production)

**预估时间**: 1小时
**负责人**: 开发团队

#### 1.6 创建目录结构
- [ ] Task 1.6.1: 创建完整的目录结构(按 SOL-008 设计)
- [ ] Task 1.6.2: 创建空文件和占位符
- [ ] Task 1.6.3: 验证目录结构符合规范

**预估时间**: 2小时
**负责人**: 开发团队

**小计**: 7小时 (约1天)

### Phase 2: 基础架构搭建 (3-4天)

#### 2.1 封装 HTTP Client
- [ ] Task 2.1.1: 实现 Request 类 (api/client/request.ts)
- [ ] Task 2.1.2: 实现请求拦截器 (api/client/interceptors.ts)
- [ ] Task 2.1.3: 实现响应拦截器
- [ ] Task 2.1.4: 实现错误拦截器
- [ ] Task 2.1.5: 实现 Token 自动刷新
- [ ] Task 2.1.6: 配置请求基础参数 (api/client/config.ts)

**预估时间**: 3小时
**负责人**: 开发团队

#### 2.2 配置 Pinia 状态管理
- [ ] Task 2.2.1: 配置 Pinia (main.ts)
- [ ] Task 2.2.2: 实现 App Store (stores/app.store.ts)
- [ ] Task 2.2.3: 实现 User Store (stores/user.store.ts)
- [ ] Task 2.2.4: 实现 Tenant Store (stores/tenant.store.ts)
- [ ] Task 2.2.5: 配置状态持久化

**预估时间**: 2小时
**负责人**: 开发团队

#### 2.3 封装工具函数
- [ ] Task 2.3.1: 实现表单验证工具 (utils/validator.ts)
- [ ] Task 2.3.2: 实现格式化工具 (utils/format.ts)
- [ ] Task 2.3.3: 实现存储封装 (utils/storage.ts)
- [ ] Task 2.3.4: 实现缓存管理 (utils/cache.ts)
- [ ] Task 2.3.5: 实现日期工具 (utils/date.ts)
- [ ] Task 2.3.6: 实现权限工具 (utils/permission.ts)

**预估时间**: 3小时
**负责人**: 开发团队

#### 2.4 创建通用组件 (7个)
- [ ] Task 2.4.1: 实现 AppNavBar 组件
- [ ] Task 2.4.2: 实现 PageContainer 组件
- [ ] Task 2.4.3: 实现 Loading 组件
- [ ] Task 2.4.4: 实现 EmptyState 组件
- [ ] Task 2.4.5: 实现 NetworkError 组件
- [ ] Task 2.4.6: 实现 Refresh 组件
- [ ] Task 2.4.7: 实现 LoadMore 组件

**预估时间**: 5小时
**负责人**: 开发团队

#### 2.5 配置路由和 TabBar
- [ ] Task 2.5.1: 配置 pages.json
- [ ] Task 2.5.2: 配置 TabBar 底部导航
- [ ] Task 2.5.3: 配置页面路由
- [ ] Task 2.5.4: 配置页面样式

**预估时间**: 2小时
**负责人**: 开发团队

#### 2.6 配置全局样式
- [ ] Task 2.6.1: 定义 SCSS 变量 (styles/variables.scss)
- [ ] Task 2.6.2: 定义 SCSS mixins (styles/mixins.scss)
- [ ] Task 2.6.3: 定义通用样式 (styles/common.scss)
- [ ] Task 2.6.4: 定义重置样式 (styles/reset.scss)
- [ ] Task 2.6.5: 配置全局样式引入

**预估时间**: 2小时
**负责人**: 开发团队

**小计**: 17小时 (约2-3天)

### Phase 3: 核心模块骨架 (4-5天)

#### 3.1 认证模块 (Auth)
- [ ] Task 3.1.1: 创建登录页面 (modules/auth/pages/login.vue)
- [ ] Task 3.1.2: 创建注册页面 (modules/auth/pages/register.vue)
- [ ] Task 3.1.3: 实现认证 Service (modules/auth/services/auth.service.ts)
- [ ] Task 3.1.4: 实现 Auth Store (modules/auth/stores/auth.store.ts)
- [ ] Task 3.1.5: 定义类型 (modules/auth/types/auth.types.ts)
- [ ] Task 3.1.6: 实现登录组件 (modules/auth/components/LoginForm.vue)

**预估时间**: 4小时
**负责人**: 开发团队

#### 3.2 设备模块 (Device)
- [ ] Task 3.2.1: 创建设备列表页 (modules/device/pages/list.vue)
- [ ] Task 3.2.2: 创建设备详情页 (modules/device/pages/detail.vue)
- [ ] Task 3.2.3: 实现 Device Service
- [ ] Task 3.2.4: 实现 Device Store
- [ ] Task 3.2.5: 定义类型
- [ ] Task 3.2.6: 实现设备卡片组件

**预估时间**: 4小时
**负责人**: 开发团队

#### 3.3 工作台模块 (Workspace)
- [ ] Task 3.3.1: 创建工作台页 (modules/workspace/pages/index.vue)
- [ ] Task 3.3.2: 实现 Workspace Service
- [ ] Task 3.3.3: 实现 Workspace Store
- [ ] Task 3.3.4: 定义类型
- [ ] Task 3.3.5: 实现快捷操作组件

**预估时间**: 3小时
**负责人**: 开发团队

#### 3.4 看板模块 (Dashboard)
- [ ] Task 3.4.1: 创建看板页 (modules/dashboard/pages/index.vue)
- [ ] Task 3.4.2: 实现 Dashboard Service
- [ ] Task 3.4.3: 实现 Dashboard Store
- [ ] Task 3.4.4: 定义类型

**预估时间**: 3小时
**负责人**: 开发团队

#### 3.5 消息模块 (Message)
- [ ] Task 3.5.1: 创建消息列表页 (modules/message/pages/list.vue)
- [ ] Task 3.5.2: 创建消息详情页 (modules/message/pages/detail.vue)
- [ ] Task 3.5.3: 实现 Message Service
- [ ] Task 3.5.4: 实现 Message Store
- [ ] Task 3.5.5: 定义类型
- [ ] Task 3.5.6: 实现消息项组件

**预估时间**: 4小时
**负责人**: 开发团队

#### 3.6 我的模块 (Profile)
- [ ] Task 3.6.1: 创建个人中心页 (modules/profile/pages/index.vue)
- [ ] Task 3.6.2: 创建设置页 (modules/profile/pages/settings.vue)
- [ ] Task 3.6.3: 实现 Profile Service
- [ ] Task 3.6.4: 实现 Profile Store
- [ ] Task 3.6.5: 定义类型

**预估时间**: 3小时
**负责人**: 开发团队

#### 3.7 配置 TabBar 页面
- [ ] Task 3.7.1: 创建工作台 TabBar 页面 (pages/tabbar/workspace.vue)
- [ ] Task 3.7.2: 创建设备 TabBar 页面 (pages/tabbar/device.vue)
- [ ] Task 3.7.3: 创建看板 TabBar 页面 (pages/tabbar/dashboard.vue)
- [ ] Task 3.7.4: 创建消息 TabBar 页面 (pages/tabbar/message.vue)
- [ ] Task 3.7.5: 创建我的 TabBar 页面 (pages/tabbar/profile.vue)

**预估时间**: 2小时
**负责人**: 开发团队

**小计**: 23小时 (约3天)

### Phase 4: 第一个页面实现 (2-3天)

#### 4.1 启动页/欢迎页
- [ ] Task 4.1.1: 创建启动页 (pages/index/index.vue)
- [ ] Task 4.1.2: 实现 Logo 展示动画
- [ ] Task 4.1.3: 显示版本信息
- [ ] Task 4.1.4: 实现自动跳转逻辑(延时2秒跳转到登录页)

**预估时间**: 2小时
**负责人**: 开发团队

#### 4.2 登录页实现
- [ ] Task 4.2.1: 实现登录表单 UI
- [ ] Task 4.2.2: 实现表单验证(手机号/邮箱格式)
- [ ] Task 4.2.3: 实现密码验证
- [ ] Task 4.2.4: 实现登录按钮交互
- [ ] Task 4.2.5: 调用登录 API (使用 Mock 数据)
- [ ] Task 4.2.6: 实现登录成功跳转
- [ ] Task 4.2.7: 实现错误提示

**预估时间**: 4小时
**负责人**: 开发团队

#### 4.3 Mock API 数据
- [ ] Task 4.3.1: 实现 Mock 认证 API
- [ ] Task 4.3.2: 实现 Mock 用户数据
- [ ] Task 4.3.3: 实现 Mock Token

**预估时间**: 1小时
**负责人**: 开发团队

#### 4.4 多端测试
- [ ] Task 4.4.1: H5 浏览器测试
- [ ] Task 4.4.2: 微信开发者工具测试
- [ ] Task 4.4.3: Android 模拟器/真机测试(可选)
- [ ] Task 4.4.4: iOS 模拟器/真机测试(可选)

**预估时间**: 3小时
**负责人**: 开发团队

**小计**: 10小时 (约1-2天)

### Phase 5: 优化和文档 (2-3天)

#### 5.1 性能优化
- [ ] Task 5.1.1: 代码分包配置
- [ ] Task 5.1.2: 图片懒加载
- [ ] Task 5.1.3: 组件懒加载
- [ ] Task 5.1.4: 虚拟列表优化(如果需要)

**预估时间**: 3小时
**负责人**: 开发团队

#### 5.2 代码优化
- [ ] Task 5.2.1: 代码审查和重构
- [ ] Task 5.2.2: 优化组件性能
- [ ] Task 5.2.3: 优化 API 调用
- [ ] Task 5.2.4: 移除未使用代码

**预估时间**: 4小时
**负责人**: 开发团队

#### 5.3 编写文档
- [ ] Task 5.3.1: 编写 README.md
- [ ] Task 5.3.2: 编写项目结构说明
- [ ] Task 5.3.3: 编写开发规范文档
- [ ] Task 5.3.4: 编写组件使用文档
- [ ] Task 5.3.5: 编写 API 对接文档

**预估时间**: 5小时
**负责人**: 开发团队

**小计**: 12小时 (约1-2天)

**总计**: 约69小时 (8-9个工作日,约2周)

## 技术实现要点

### 文件结构

按 SOL-008 设计的目录结构实现:

```
platforms/app/pansiot-app/
├── src/
│   ├── components/
│   ├── modules/
│   ├── pages/
│   ├── api/
│   ├── stores/
│   ├── utils/
│   ├── hooks/
│   ├── directives/
│   ├── filters/
│   ├── styles/
│   ├── config/
│   ├── types/
│   ├── App.vue
│   ├── main.ts
│   ├── pages.json
│   ├── manifest.json
│   └── uni.scss
├── static/
├── uni_modules/
├── .env.development
├── .env.production
├── .eslintrc.js
├── .prettierrc
├── tsconfig.json
├── vite.config.ts
├── package.json
└── README.md
```

### 核心类/组件

| 类名/组件名 | 职责 | 文件路径 | 关键方法 |
|------------|------|---------|---------|
| **Request** | HTTP 请求封装 | src/api/client/request.ts | request(), get(), post() |
| **Interceptor** | 请求/响应拦截 | src/api/client/interceptors.ts | request(), response(), error() |
| **useAppStore** | 应用状态 | src/stores/app.store.ts | setTheme(), setLanguage() |
| **useUserStore** | 用户状态 | src/stores/user.store.ts | login(), logout() |
| **useTenantStore** | 租户状态 | src/stores/tenant.store.ts | switchTenant() |
| **AppNavBar** | 自定义导航栏 | src/components/common/AppNavBar.vue | - |
| **PageContainer** | 页面容器 | src/components/common/PageContainer.vue | - |
| **Loading** | 加载指示器 | src/components/common/Loading.vue | - |
| **EmptyState** | 空状态 | src/components/common/EmptyState.vue | - |
| **LoginForm** | 登录表单 | src/modules/auth/components/LoginForm.vue | handleLogin() |

### 关键算法/逻辑

#### 1. Token 自动刷新算法

```pseudocode
IF response.code == 401 (Token过期) THEN
  TRY
    refreshTokenResult = CALL /api/auth/refresh WITH refreshToken
    IF refreshTokenResult.code == 200 THEN
      UPDATE userStore.token = refreshTokenResult.data.token
      RETRY original request
    ELSE
      LOGOUT user
      NAVIGATE to login page
    END IF
  CATCH error
    LOGOUT user
    NAVIGATE to login page
  END TRY
END IF
```

**复杂度**: O(1) 时间 / O(1) 空间

#### 2. 请求拦截逻辑

```pseudocode
BEFORE every request:
  ADD Authorization header WITH userStore.token
  ADD X-Tenant-ID header WITH tenantStore.currentTenant.id
  ADD Content-Type header AS 'application/json'
  IF request is GET THEN
    ADD _t parameter WITH current timestamp (防缓存)
  END IF
END BEFORE
```

**复杂度**: O(1) 时间 / O(1) 空间

## 代码实现映射表

| 功能ID | 功能点 | 文件路径 | 类/组件 | 函数/方法 | 行号范围 | 状态 |
|--------|--------|---------|---------|----------|---------|------|
| FE-008-01 | UniApp 项目创建 | package.json | - | - | 1-50 | ⏳ |
| FE-008-02 | 目录结构 | src/ | - | - | - | ⏳ |
| FE-008-03 | TypeScript 配置 | tsconfig.json | - | - | 1-50 | ⏳ |
| FE-008-04 | Vite 配置 | vite.config.ts | - | - | 1-100 | ⏳ |
| FE-008-05 | Pinia 配置 | src/main.ts | - | createPinia() | 15-20 | ⏳ |
| FE-008-06 | HTTP Client 封装 | src/api/client/request.ts | Request | request() | 20-60 | ⏳ |
| FE-008-07 | 请求拦截器 | src/api/client/interceptors.ts | Interceptor | request() | 15-45 | ⏳ |
| FE-008-08 | 响应拦截器 | src/api/client/interceptors.ts | Interceptor | response() | 47-80 | ⏳ |
| FE-008-09 | App Store | src/stores/app.store.ts | useAppStore | setTheme() | 25-30 | ⏳ |
| FE-008-10 | User Store | src/stores/user.store.ts | useUserStore | login() | 30-50 | ⏳ |
| FE-008-11 | AppNavBar 组件 | src/components/common/AppNavBar.vue | AppNavBar | - | 1-100 | ⏳ |
| FE-008-12 | Loading 组件 | src/components/common/Loading.vue | Loading | - | 1-80 | ⏳ |
| FE-008-13 | EmptyState 组件 | src/components/common/EmptyState.vue | EmptyState | - | 1-60 | ⏳ |
| FE-008-14 | 登录页面 | src/modules/auth/pages/login.vue | - | handleLogin() | 50-120 | ⏳ |
| FE-008-15 | 启动页面 | src/pages/index/index.vue | - | onLoad() | 30-60 | ⏳ |
| FE-008-16 | 工具函数 | src/utils/validator.ts | - | validatePhone() | 10-25 | ⏳ |

## 依赖项

### 前置依赖
- **实现依赖**: 无
- **功能依赖**:
  - FE-007: 云平台账号系统 (弱依赖,可使用 Mock)
- **外部依赖**: UniApp CLI, HBuilderX, Node.js 16+

### 后置依赖
- **被依赖**:
  - FE-009: 设备管理功能
  - FE-010: 工程管理功能
  - FE-011: 消息推送功能
  - FE-012: 数据可视化功能
- **影响范围**: 所有后续移动端功能

### 外部依赖

| 依赖名 | 版本 | 用途 | 许可证 |
|--------|------|------|--------|
| vue | 3.3+ | 前端框架 | MIT |
| pinia | 2.1+ | 状态管理 | MIT |
| uview-ui | 2.0+ | UI 组件库 | MIT |
| typescript | 5.0+ | TypeScript 支持 | Apache 2.0 |
| eslint | 8.0+ | 代码规范 | MIT |
| prettier | 3.0+ | 代码格式化 | MIT |
| @dcloudio/uni-app | 3.0+ | UniApp 框架 | MIT |
| @dcloudio/vite-plugin-uni | 3.0+ | Vite 插件 | MIT |

## 测试策略

### 单元测试
- **覆盖率目标**: 60% (工具函数和核心逻辑)
- **测试框架**: Vitest + @testing-library/vue
- **关键测试用例**:
  - HTTP Client 请求拦截
  - HTTP Client 响应拦截
  - Store actions (login, logout)
  - 表单验证工具
  - 格式化工具

### 集成测试
- **测试场景**:
  - 登录流程 (输入 → 验证 → 提交 → 成功 → 跳转)
  - Token 自动刷新
  - 网络错误处理
  - 多端兼容性测试

### 验收测试
- **验收标准**:
  - [ ] 项目可正常编译运行
  - [ ] 启动页可正常显示
  - [ ] 登录页可正常显示和交互
  - [ ] 表单验证正常工作
  - [ ] Mock API 调用成功
  - [ ] 登录成功后可正常跳转
  - [ ] H5 端运行正常
  - [ ] 微信小程序端运行正常
  - [ ] 代码符合 ESLint 规范
  - [ ] TypeScript 编译无错误
  - [ ] 目录结构符合设计
  - [ ] 代码映射表已更新

## 依赖忽略记录

由于 FE-007 (云平台账号系统) 尚未完成,本项目将使用 Mock 数据进行并行开发。

| ID | 依赖模块 | 忽略内容 | Mock位置 | 补齐优先级 | 状态 |
|----|---------|---------|---------|-----------|------|
| D-008-01 | FE-007 | 云平台认证 API | src/api/modules/auth.api.ts | P0 | ⏳ |
| D-008-02 | FE-007 | 云平台设备 API | src/api/modules/device.api.ts | P0 | ⏳ |
| D-008-03 | FE-007 | 云平台消息 API | src/api/modules/message.api.ts | P0 | ⏳ |

### Mock 实现示例

```typescript
// TODO(依赖): FE-007 - 云平台账号系统
// 说明: 此处需要调用云平台认证 API 进行用户登录
// 当前状态: 使用 Mock 实现
// 依赖模块: IMP-007
// 补齐优先级: P0
// 预计补齐日期: 2026-02-15
// 负责人: 开发团队

// === 依赖忽略开始 ===
export const authApi = {
  // Mock 登录
  login: (params: LoginParams) => {
    return Promise.resolve({
      code: 200,
      data: {
        token: 'mock-token-' + Date.now(),
        refreshToken: 'mock-refresh-token',
        expiresIn: 7200,
        user: {
          id: 'mock-user-001',
          username: params.username,
          phone: params.username,
          avatar: '',
          roles: [],
          tenantId: 'mock-tenant-001',
          tenantName: '测试企业',
          createdAt: '2026-01-28',
        },
      },
      message: '登录成功',
    });
  },

  // Mock 刷新 Token
  refreshToken: (refreshToken: string) => {
    return Promise.resolve({
      code: 200,
      data: {
        token: 'mock-new-token-' + Date.now(),
      },
      message: '刷新成功',
    });
  },
};
// === 依赖忽略结束 ===
```

## 实现日志

### 2026-01-28
- ✅ Stage 2 完成 - 技术方案设计 (SOL-008)
- ✅ 创建 5 个架构决策记录 (ADR)
- 🔄 Stage 3 开始 - 实施计划制定 (IMP-008)
- ⏳ 准备开始 Phase 1: 项目初始化

## 问题记录

| 日期 | 问题描述 | 严重程度 | 解决方案 | 状态 | 责任人 |
|------|---------|---------|---------|------|--------|
| - | - | - | - | - | - |

## 代码审查

### 审查清单
- [ ] 代码符合项目规范
- [ ] 充分的注释和文档
- [ ] 错误处理完善
- [ ] 单元测试覆盖
- [ ] 性能考虑充分
- [ ] 安全检查通过

### 审查意见
| 审查人 | 日期 | 意见 | 状态 |
|--------|------|------|------|
| - | - | - | - |

## 验证记录

### 测试结果
- **单元测试**: ⏳ 待测试
- **集成测试**: ⏳ 待测试
- **性能测试**: ⏳ 待测试
- **安全扫描**: ⏳ 待测试

### 测试报告
待实施完成后生成

## 部署计划

### 部署环境
- **开发环境**: 本地 HBuilderX 运行
- **测试环境**: 微信开发者工具
- **预生产环境**: ⏳ 待配置
- **生产环境**: ⏳ 待配置

### 部署步骤
1. 本地开发调试 (H5 端)
2. 微信小程序测试
3. Android/iOS 真机测试(可选)
4. 性能优化
5. 打包发布

### 回滚计划
- 使用 Git 版本控制,可随时回退到上一个稳定版本

## 文档更新

- [ ] README.md 已编写
- [ ] 项目结构说明已编写
- [ ] 开发规范文档已编写
- [ ] 组件使用文档已编写
- [ ] API 对接文档已编写

## 变更历史
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2026-01-28 | 1.0 | 初始创建 | Claude Code |
