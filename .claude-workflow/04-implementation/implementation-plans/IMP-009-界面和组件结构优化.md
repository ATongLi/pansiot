# IMP-009: 界面和组件结构优化实施计划

## 元数据
- **实现ID**: IMP-009
- **关联方案**: SOL-009
- **关联功能**: FE-009
- **实现状态**: 待开始
- **开始日期**: 2026-01-28
- **预计完成**: 2026-02-20 (17个工作日)
- **实际完成**: 待定
- **负责人**: 开发团队

## 实现概述

对 Scada 工程编辑器进行全面的界面和组件结构优化，包括：
1. 实现应用级标签栏系统（TabBar + 动态标签管理）
2. 重构首页和工程编辑器布局
3. 实现智能工具栏交互（固定/动态模式）
4. 实现编辑内容页内部标签系统
5. 实现可配置的编辑选项栏（左侧/顶部布局）
6. 创建完整的组件开发规范文档（COMPONENT_STANDARDS.md）

采用 **分层组件架构** + **MobX 状态管理**，并输出统一的开发规范和模板。

## 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.3.1 | UI框架 |
| TypeScript | 5.x | 类型安全 |
| MobX | 6.12.0 | 状态管理 |
| mobx-react-lite | 6.12.0 | MobX React 集成 |
| Electron | 28 | 桌面框架 |
| Vite | 5.4.21 | 构建工具 |
| CSS Modules | - | 样式隔离 |
| CSS Variables | - | 主题系统 |
| Jest | 29.x | 单元测试 |
| React Testing Library | 14.x | 组件测试 |
| ESLint | 8.x | 代码检查 |
| Prettier | 3.x | 代码格式化 |

## 任务分解

### Phase 1: 基础架构与状态管理 (3天)

#### Task 1.1: 创建 MobX Store 架构
- [ ] 创建 `TabStore` (应用级标签管理)
  - 定义 Tab 接口
  - 实现 addTab(), closeTab(), setActiveTab() 方法
  - 实现响应式属性 (observable, computed)
  - 预估: 2h
- [ ] 创建 `SubPageTabStore` (内部标签管理)
  - 定义 SubPageTab 接口
  - 实现 addSubTab(), closeSubTab(), setActiveSubTab() 方法
  - 预估: 1.5h
- [ ] 创建 `ToolbarStore` (工具栏状态)
  - 定义工具栏选项接口
  - 实现模式切换 (fixed/dynamic)
  - 实现显示/隐藏逻辑
  - 预估: 1h
- [ ] 创建 `LayoutStore` (布局配置)
  - 定义编辑选项栏布局配置
  - 实现布局切换和持久化
  - 实现侧边栏折叠状态
  - 预估: 1h
- [ ] 创建 Store 导出文件 `src/store/index.ts`
  - 导出所有 Store 实例
  - 导出 Store 类型定义
  - 预估: 0.5h
- **负责人**: 前端开发
- **总计**: 6h

#### Task 1.2: 重构 App.tsx 实现标签栏逻辑
- [ ] 定义 Tab 接口和数据结构
- [ ] 实现应用级标签状态管理
- [ ] 实现标签渲染逻辑（根据 tab.type 渲染不同内容）
- [ ] 实现标签激活和关闭功能
- [ ] 实现"打开工程"创建新标签功能
- 预估: 3h
- **负责人**: 前端开发

#### Task 1.3: 创建 TabBar、Tab、WindowControls 组件
- [ ] **TabBar 组件** (`src/components/common/TabBar.tsx`)
  - 渲染标签列表
  - 处理标签点击事件
  - 处理标签关闭事件
  - 样式实现（选中、未选中、悬浮状态）
  - 预估: 2h
- [ ] **Tab 组件** (`src/components/common/Tab.tsx`)
  - 显示标签图标、标题、关闭按钮
  - 处理点击和关闭事件
  - 样式实现
  - 预估: 1h
- [ ] **WindowControls 组件** (`src/components/common/WindowControls.tsx`)
  - 最小化、最大化、关闭按钮
  - 调用 electronAPI
  - 样式实现
  - 预估: 1.5h
- [ ] CSS Modules 样式文件
  - TabBar.module.css
  - Tab.module.css
  - WindowControls.module.css
  - 预估: 1.5h
- **负责人**: 前端开发
- **总计**: 6h

**Phase 1 总计**: 15h (约2个工作日)

---

### Phase 2: 首页重构 (2天)

#### Task 2.1: 重构 HomePage 组件
- [ ] **HomePage 布局** (`src/components/pages/HomePage.tsx`)
  - 左侧导航侧边栏
  - 右侧内容展示区
  - 响应式布局
  - 预估: 2h
- [ ] **Sidebar 导航栏** (`src/components/common/Sidebar.tsx`)
  - 导航选项列表（首页、本地、云端、工具）
  - 选项状态管理（选中、未选中、悬浮）
  - 点击事件处理
  - 样式实现
  - 预估: 2h
- [ ] **MainContent 主内容区** (`src/components/workspace/MainContent.tsx`)
  - "开始"部分布局
  - "最近工程"部分布局
  - 回调函数传递（onOpenProject）
  - 预估: 1.5h
- **负责人**: 前端开发
- **总计**: 5.5h

#### Task 2.2: 重构 ActionButtons 和 RecentProjects
- [ ] **ActionButtons** (`src/components/workspace/ActionButtons.tsx`)
  - 新建工程按钮（mock，后续实现）
  - 从文件打开工程按钮（调用 electronAPI）
  - 复制工程按钮（mock）
  - 实现文件读取和工程打开逻辑
  - 预估: 2h
- [ ] **RecentProjects** (`src/components/workspace/RecentProjects.tsx`)
  - 最近工程列表（从 Store 获取）
  - 工程卡片组件
  - 点击打开工程功能
  - 样式优化
  - 预估: 1.5h
- [ ] CSS Modules 样式文件
  - HomePage.module.css
  - Sidebar.module.css
  - ActionButtons.module.css
  - RecentProjects.module.css
  - 预估: 2h
- **负责人**: 前端开发
- **总计**: 5.5h

**Phase 2 总计**: 11h (约1.5个工作日，合并到2天)

---

### Phase 3: 工程编辑器布局 (3天)

#### Task 3.1: 创建 EditorPage 主布局
- [ ] **EditorPage 组件** (`src/components/editor/EditorPage.tsx`)
  - 主布局容器（TopToolbar + SubToolbar + EditorContent + StatusBar）
  - 从 TabStore 获取工程信息
  - 样式实现
  - 预估: 2h
- [ ] **TopToolbar 组件** (`src/components/editor/toolbar/TopToolbar.tsx`)
  - 工具选项按钮（文件、编辑、视图、工具）
  - 选项状态管理
  - 点击事件处理（更新 ToolbarStore）
  - 样式实现（32px高度）
  - 预估: 2h
- [ ] **SubToolbar 组件** (`src/components/editor/toolbar/SubToolbar.tsx`)
  - 显示当前主工具选项对应的子功能
  - 支持固定/动态模式
  - 动态内容切换
  - 样式实现（64px高度）
  - 预估: 2.5h
- [ ] **StatusBar 组件** (`src/components/editor/statusbar/StatusBar.tsx`)
  - 状态信息显示
  - 样式实现（24px高度）
  - 预估: 1h
- **负责人**: 前端开发
- **总计**: 7.5h

#### Task 3.2: 实现工具栏状态管理和交互
- [ ] 集成 ToolbarStore 到组件
- [ ] 实现主工具栏选项切换逻辑
- [ ] 实现子工具栏固定/动态模式切换
- [ ] 实现动态模式下失去焦点自动隐藏
  - 监听焦点事件
  - 延迟隐藏（避免误触）
- [ ] CSS 样式和动画效果
- 预估: 3h
- **负责人**: 前端开发

#### Task 3.3: 创建 EditorContent 容器
- [ ] **EditorContent 组件** (`src/components/editor/EditorContent.tsx`)
  - 左侧编辑选项栏容器
  - 右侧子页面区容器
  - Flex 布局实现
  - 预估: 1.5h
- [ ] CSS Modules 样式
  - TopToolbar.module.css
  - SubToolbar.module.css
  - EditorPage.module.css
  - EditorContent.module.css
  - StatusBar.module.css
  - 预估: 2h
- **负责人**: 前端开发
- **总计**: 3.5h

**Phase 3 总计**: 14h (约2个工作日，合并到3天)

---

### Phase 4: 编辑内容区 (3天)

#### Task 4.1: 创建 EditOptionsBar 组件
- [ ] **EditOptionsBar 组件** (`src/components/editor/sidebar/EditOptionsBar.tsx`)
  - 编辑选项列表（工程、画面、组件）
  - 支持左侧竖向布局
  - 支持顶部横向布局
  - 选项状态管理
  - 点击事件处理
  - 预估: 3h
- [ ] 集成 LayoutStore
- [ ] 实现布局切换功能
  - 配置项存储（localStorage）
  - 运行时切换
  - 布局切换动画
- 预估: 2h
- [ ] CSS Modules 样式
  - EditOptionsBar.module.css
  - 左侧布局样式
  - 顶部布局样式
  - 布局切换动画
  - 预估: 2h
- **负责人**: 前端开发
- **总计**: 7h

#### Task 4.2: 创建 SubPageArea 和内部标签系统
- [ ] **SubPageArea 组件** (`src/components/editor/subpage/SubPageArea.tsx`)
  - 内部标签栏容器
  - 内容区容器
  - 布局实现
  - 预估: 2h
- [ ] **SubPageTabBar 组件** (`src/components/editor/subpage/SubPageTabBar.tsx`)
  - 内部标签列表
  - 标签切换和关闭功能
  - 集成 SubPageTabStore
  - 样式实现
  - 预估: 2.5h
- [ ] **SubPageContent 组件** (`src/components/editor/subpage/SubPageContent.tsx`)
  - 根据激活标签显示对应内容
  - 支持多种内容类型
  - 预估: 1.5h
- [ ] CSS Modules 样式
  - SubPageArea.module.css
  - SubPageTabBar.module.css
  - 预估: 1.5h
- **负责人**: 前端开发
- **总计**: 7.5h

#### Task 4.3: 实现内部标签管理逻辑
- [ ] 集成 SubPageTabStore 到组件
- [ ] 实现打开编辑内容创建内部标签
- [ ] 实现内部标签切换功能
- [ ] 实现关闭后自动切换到其他标签
- [ ] 测试多标签场景
- 预估: 3h
- **负责人**: 前端开发

**Phase 4 总计**: 17.5h (约2.5个工作日，合并到3天)

---

### Phase 5: 组件规范化与模板 (4天)

#### Task 5.1: 创建 COMPONENT_STANDARDS.md 规范文档 ⭐
- [ ] **组件设计规范**章节
  - Props 接口规范（命名、类型、默认值、验证）
  - Events 接口规范（命名、参数、类型）
  - 组件生命周期规范（useEffect、useCallback）
  - 组件状态管理规范（useState、useContext、MobX）
  - 组件通信规范（props、context、event bus）
  - 预估: 3h
- [ ] **模块组织规范**章节
  - 目录结构规范（src/components、src/modules、src/stores）
  - 文件命名规范（PascalCase.tsx、camelCase.ts）
  - 模块导入导出规范（named exports、default exports）
  - 模块依赖管理规范（绝对路径、相对路径、循环依赖）
  - 预估: 2h
- [ ] **代码编写规范**章节
  - 组件命名规范（PascalCase）
  - 文件命名规范
  - 变量命名规范（camelCase、UPPER_CASE）
  - 函数命名规范（camelCase、handle*）
  - TypeScript 类型定义规范（interface、type、enum）
  - JSDoc 注释规范（组件、函数、复杂类型）
  - 错误处理规范（try-catch、error boundaries）
  - 预估: 2h
- [ ] **样式规范**章节
  - CSS Modules 使用规范
  - 样式变量使用规范（CSS Variables）
  - 响应式设计规范
  - 样式隔离规范
  - 预估: 1.5h
- [ ] **状态管理规范**章节
  - Store 设计规范（单一职责、命名）
  - Observable 数据规范（@observable、@computed、@action）
  - Action 定义规范（异步操作、错误处理）
  - Computed 定义规范（派生状态、性能）
  - 预估: 1.5h
- [ ] **测试规范**章节
  - 单元测试规范（Jest + React Testing Library）
  - 集成测试规范（测试场景、测试数据）
  - 测试覆盖率要求（行覆盖率 > 80%）
  - 测试命名规范（describe、test、expect）
  - 预估: 1h
- **负责人**: 前端架构师 + Tech Lead
- **总计**: 11h

#### Task 5.2: 创建组件开发模板
- [ ] **函数组件模板** (`templates/FunctionComponent.template.tsx`)
  - Props 接口定义
  - 基础生命周期 hooks（useEffect、useCallback）
  - CSS Modules 导入
  - JSDoc 注释模板
  - 预估: 2h
- [ ] **MobX 组件模板** (`templates/MobxComponent.template.tsx`)
  - observer HOC 应用
  - Store 注入方式
  - Observable 数据使用
  - 预估: 1.5h
- [ ] **Store 模板** (`templates/Store.template.ts`)
  - 类定义和构造函数
  - Observable 字段
  - Action 方法
  - Computed 属性
  - 预估: 1.5h
- [ ] **README** 说明文档
  - 模板使用说明
  - 示例代码
  - 预估: 1h
- **负责人**: 前端架构师
- **总计**: 6h

#### Task 5.3: 创建规范遵循检查清单
- [ ] **COMPONENT_CHECKLIST.md**
  - 组件设计检查项（接口、生命周期、状态管理）
  - 代码质量检查项（命名、注释、类型定义）
  - 样式规范检查项（CSS Modules、主题、响应式）
  - 测试覆盖检查项（单元测试、集成测试、覆盖率）
  - 文档完整性检查项（JSDoc、README）
  - 预估: 3h
- **负责人**: 前端架构师 + QA

#### Task 5.4: 配置开发工具
- [ ] **ESLint 规则配置** (`.eslintrc.js`)
  - React 规则
  - TypeScript 规则
  - 自定义规则（组件命名、文件命名等）
  - 预估: 2h
- [ ] **Prettier 配置** (`.prettierrc`)
  - 代码格式化规则
  - 与 ESLint 集成
  - 预估: 0.5h
- [ ] **Git Hooks** (husky + lint-staged)
  - Commit 前检查
  - Push 前检查
  - 自动格式化
  - 预估: 2h
- [ ] **CI/CD 集成**
  - 自动化检查配置
  - 测试覆盖率报告
  - 预估: 1.5h
- **负责人**: 前端开发 + DevOps
- **总计**: 6h

#### Task 5.5: 重构已有组件以符合规范
- [ ] **重构 Phase 1-4 组件**
  - FE-009-01 ~ FE-009-09 所有组件
  - 更新组件接口以符合规范
  - 补充 JSDoc 注释
  - 优化文件组织和命名
  - 添加单元测试
  - 预估: 8h
- [ ] **代码审查**
  - 检查规范遵循情况
  - 提出改进意见
  - 预估: 2h
- **负责人**: 全体前端开发
- **总计**: 10h

**Phase 5 总计**: 36h (约4.5个工作日，合并到4天)

---

### Phase 6: 集成测试与优化 (2天)

#### Task 6.1: 全面功能测试
- [ ] 应用级标签栏功能测试
  - 创建标签
  - 切换标签
  - 关闭标签
  - 标签激活逻辑
  - 预估: 2h
- [ ] 首页功能测试
  - 导航切换
  - 打开工程
  - 最近工程列表
  - 预估: 1.5h
- [ ] 工程编辑器功能测试
  - 工具栏交互
  - 子工具栏模式切换
  - 编辑选项栏布局切换
  - 内部标签管理
  - 预估: 2h
- [ ] 边界场景测试
  - 多标签场景（10+）
  - 快速切换标签
  - 长时间运行测试
  - 预估: 1.5h
- **负责人**: QA + 前端开发
- **总计**: 7h

#### Task 6.2: 性能测试和优化
- [ ] **性能测试**
  - 标签切换响应时间（目标 < 100ms）
  - 组件首次渲染时间（目标 < 500ms）
  - 内存占用测试
  - 预估: 2h
- [ ] **性能优化**
  - React.memo 优化
  - useMemo、useCallback 优化
  - 虚拟滚动（如需要）
  - 懒加载优化
  - 预估: 3h
- **负责人**: 前端开发
- **总计**: 5h

#### Task 6.3: 兼容性测试和修复
- [ ] **兼容性测试**
  - 不同 DPI 测试（100%、150%、200%）
  - 不同分辨率测试（1920x1080、2560x1440）
  - Windows 10/11 测试
  - 预估: 2h
- [ ] **Bug 修复**
  - 修复测试中发现的问题
  - 回归测试
  - 预估: 2h
- **负责人**: QA + 前端开发
- **总计**: 4h

**Phase 6 总计**: 16h (约2个工作日)

---

## 技术实现要点

### 文件结构

```
platforms/scada/packages/renderer/src/
├── components/
│   ├── common/                    # 通用组件
│   │   ├── TabBar.tsx
│   │   ├── Tab.tsx
│   │   ├── WindowControls.tsx
│   │   ├── Sidebar.tsx
│   │   └── ...
│   ├── pages/                     # 页面组件
│   │   ├── HomePage.tsx
│   │   └── editor/
│   │       ├── EditorPage.tsx
│   │       ├── EditorContent.tsx
│   │       └── subpage/
│   │           ├── SubPageArea.tsx
│   │           ├── SubPageTabBar.tsx
│   │           └── SubPageContent.tsx
│   ├── workspace/                 # 工作区组件
│   │   ├── MainContent.tsx
│   │   ├── ActionButtons.tsx
│   │   └── RecentProjects.tsx
│   ├── editor/                    # 编辑器组件
│   │   ├── toolbar/
│   │   │   ├── TopToolbar.tsx
│   │   │   └── SubToolbar.tsx
│   │   ├── sidebar/
│   │   │   └── EditOptionsBar.tsx
│   │   └── statusbar/
│   │       └── StatusBar.tsx
│   └── ui/                        # UI组件库
│       ├── Button/
│       ├── Input/
│       └── ...
├── store/                         # MobX Stores
│   ├── TabStore.ts
│   ├── SubPageTabStore.ts
│   ├── ToolbarStore.ts
│   ├── LayoutStore.ts
│   └── index.ts
├── types/                         # TypeScript 类型定义
│   ├── tab.ts
│   ├── toolbar.ts
│   └── layout.ts
├── utils/                         # 工具函数
├── hooks/                         # 自定义 Hooks
├── App.tsx                        # 应用根组件
└── main.tsx                       # 应用入口

templates/                          # 组件开发模板
├── FunctionComponent.template.tsx
├── MobxComponent.template.tsx
└── Store.template.ts
```

### 核心类/组件

| 类名/组件名 | 职责 | 文件路径 | 关键方法 |
|------------|------|---------|---------|
| **App** | 应用根组件，管理标签栏和内容区 | src/App.tsx | openProjectInEditor(), renderTabContent() |
| **TabStore** | 应用级标签状态管理 | src/store/TabStore.ts | addTab(), closeTab(), setActiveTab() |
| **SubPageTabStore** | 内部标签状态管理 | src/store/SubPageTabStore.ts | addSubTab(), closeSubTab(), setActiveSubTab() |
| **ToolbarStore** | 工具栏状态管理 | src/store/ToolbarStore.ts | selectToolOption(), setSubToolbarMode(), hideSubToolbar() |
| **LayoutStore** | 布局配置管理 | src/store/LayoutStore.ts | setEditOptionLayout(), toggleSidebar(), loadSettings() |
| **TabBar** | 应用级标签栏组件 | src/components/common/TabBar.tsx | render(), handleTabClick(), handleTabClose() |
| **HomePage** | 首页组件 | src/components/pages/HomePage.tsx | render() |
| **EditorPage** | 工程编辑器页面 | src/components/editor/EditorPage.tsx | render() |
| **TopToolbar** | 主工具栏组件 | src/components/editor/toolbar/TopToolbar.tsx | handleOptionClick() |
| **SubToolbar** | 子工具栏组件 | src/components/editor/toolbar/SubToolbar.tsx | render() |
| **EditOptionsBar** | 编辑选项栏组件 | src/components/editor/sidebar/EditOptionsBar.tsx | handleOptionClick() |
| **SubPageTabBar** | 内部标签栏组件 | src/components/editor/subpage/SubPageTabBar.tsx | handleTabClick(), handleTabClose() |

### 关键算法/逻辑

#### 1. 标签激活和关闭逻辑

```typescript
// TabStore.closeTab()
closeTab(tabId: string): void {
  const index = this.tabs.findIndex(t => t.id === tabId)
  if (index === -1) return

  this.tabs.splice(index, 1)

  // 如果关闭的是当前激活标签，切换到其他标签
  if (this.activeTab === tabId) {
    if (this.tabs.length > 0) {
      // 优先切换到右侧标签，如果没有则切换到左侧
      this.activeTab = this.tabs[Math.min(index, this.tabs.length - 1)].id
    } else {
      // 没有标签了，清空激活状态
      this.activeTab = ''
    }
  }
}
```

**复杂度**: O(n) - 查找标签是线性时间

#### 2. 子工具栏动态隐藏逻辑

```typescript
// ToolbarStore.hideSubToolbar()
hideSubToolbar(): void {
  if (this.subToolbarMode === 'dynamic') {
    // 延迟隐藏，避免误触
    setTimeout(() => {
      // 检查是否仍然失去焦点
      if (!this.isSubToolbarFocused) {
        this.subToolbarVisible = false
      }
    }, 200)
  }
}
```

**复杂度**: O(1)

## 代码实现映射表

| 功能ID | 功能点 | 文件路径 | 类/组件 | 函数/方法 | 行号范围 | 状态 |
|--------|--------|---------|---------|----------|---------|------|
| **FE-009-01** | 应用级标签栏系统 | | | | | |
| FE-009-01-01 | TabBar布局组件 | src/components/common/TabBar.tsx | TabBar | render() | 1-50 | ⏳ |
| FE-009-01-02 | Tab组件 | src/components/common/Tab.tsx | Tab | render(), handleClick(), handleClose() | 1-80 | ⏳ |
| FE-009-01-03 | WindowControls组件 | src/components/common/WindowControls.tsx | WindowControls | handleMinimize(), handleMaximize(), handleClose() | 1-60 | ⏳ |
| FE-009-01-04 | 标签管理功能 | src/store/TabStore.ts | TabStore | addTab(), closeTab(), setActiveTab() | 1-100 | ⏳ |
| **FE-009-02** | 首页主内容区 | | | | | |
| FE-009-02-01 | HomePage组件 | src/components/pages/HomePage.tsx | HomePage | render() | 1-60 | ⏳ |
| FE-009-02-02 | Sidebar导航栏 | src/components/common/Sidebar.tsx | Sidebar | render(), handleNavClick() | 1-80 | ⏳ |
| FE-009-02-03 | MainContent组件 | src/components/workspace/MainContent.tsx | MainContent | render() | 1-50 | ⏳ |
| FE-009-02-04 | ActionButtons组件 | src/components/workspace/ActionButtons.tsx | ActionButtons | handleNewProject(), handleOpenProject() | 1-100 | ⏳ |
| FE-009-02-05 | RecentProjects组件 | src/components/workspace/RecentProjects.tsx | RecentProjects | render(), handleProjectClick() | 1-80 | ⏳ |
| **FE-009-03** | 工程编辑器主布局 | | | | | |
| FE-009-03-01 | EditorPage组件 | src/components/editor/EditorPage.tsx | EditorPage | render() | 1-60 | ⏳ |
| FE-009-03-02 | TopToolbar组件 | src/components/editor/toolbar/TopToolbar.tsx | TopToolbar | handleOptionClick() | 1-80 | ⏳ |
| FE-009-03-03 | SubToolbar组件 | src/components/editor/toolbar/SubToolbar.tsx | SubToolbar | render() | 1-60 | ⏳ |
| FE-009-03-04 | StatusBar组件 | src/components/editor/statusbar/StatusBar.tsx | StatusBar | render() | 1-40 | ⏳ |
| **FE-009-04** | 工具栏交互系统 | | | | | |
| FE-009-04-01 | 主工具栏状态管理 | src/store/ToolbarStore.ts | ToolbarStore | selectToolOption() | 1-50 | ⏳ |
| FE-009-04-02 | 子工具栏模式切换 | src/store/ToolbarStore.ts | ToolbarStore | setSubToolbarMode() | 1-30 | ⏳ |
| FE-009-04-03 | 子工具栏动态隐藏 | src/store/ToolbarStore.ts | ToolbarStore | hideSubToolbar() | 1-40 | ⏳ |
| **FE-009-05** | 编辑内容区域布局 | | | | | |
| FE-009-05-01 | EditorContent组件 | src/components/editor/EditorContent.tsx | EditorContent | render() | 1-50 | ⏳ |
| FE-009-05-02 | EditOptionsBar组件 | src/components/editor/sidebar/EditOptionsBar.tsx | EditOptionsBar | render(), handleLayoutChange() | 1-120 | ⏳ |
| FE-009-05-03 | 布局配置管理 | src/store/LayoutStore.ts | LayoutStore | setEditOptionLayout() | 1-60 | ⏳ |
| **FE-009-06** | 内部标签系统 | | | | | |
| FE-009-06-01 | SubPageTabBar组件 | src/components/editor/subpage/SubPageTabBar.tsx | SubPageTabBar | render(), handleTabClick(), handleTabClose() | 1-80 | ⏳ |
| FE-009-06-02 | 内部标签管理 | src/store/SubPageTabStore.ts | SubPageTabStore | addSubTab(), closeSubTab() | 1-100 | ⏳ |
| FE-009-06-03 | SubPageContent组件 | src/components/editor/subpage/SubPageContent.tsx | SubPageContent | render() | 1-50 | ⏳ |
| **FE-009-07** | 组件化重构 | | | | | |
| FE-009-07-01 | 应用级组件库 | src/components/common/ | 多个组件 | - | - | ⏳ |
| FE-009-07-02 | 布局组件库 | src/components/layout/ | 多个组件 | - | - | ⏳ |
| FE-009-07-03 | 功能组件库 | src/components/editor/ | 多个组件 | - | - | ⏳ |
| FE-009-07-04 | UI组件库 | src/components/ui/ | 多个组件 | - | - | ⏳ |
| **FE-009-08** | 状态管理优化 | | | | | |
| FE-009-08-01 | TabStore | src/store/TabStore.ts | TabStore | - | 1-100 | ⏳ |
| FE-009-08-02 | SubPageTabStore | src/store/SubPageTabStore.ts | SubPageTabStore | - | 1-100 | ⏳ |
| FE-009-08-03 | ToolbarStore | src/store/ToolbarStore.ts | ToolbarStore | - | 1-80 | ⏳ |
| FE-009-08-04 | LayoutStore | src/store/LayoutStore.ts | LayoutStore | - | 1-60 | ⏳ |
| **FE-009-09** | 样式系统统一 | | | | | |
| FE-009-09-01 | CSS Modules样式 | 所有组件 .module.css | - | - | - | ⏳ |
| FE-009-09-02 | CSS变量使用 | 所有组件 | - | - | - | ⏳ |
| **FE-009-10** | 组件及模块规范制定 | | | | | |
| FE-009-10-01 | COMPONENT_STANDARDS.md | platforms/scada/packages/renderer/COMPONENT_STANDARDS.md | - | - | 1-500 | ⏳ |
| FE-009-10-02 | 组件开发模板 | templates/*.template.tsx | - | - | - | ⏳ |
| FE-009-10-03 | 规范遵循检查清单 | platforms/scada/packages/renderer/COMPONENT_CHECKLIST.md | - | - | 1-200 | ⏳ |
| FE-009-10-04 | ESLint/Prettier配置 | .eslintrc.js, .prettierrc | - | - | - | ⏳ |
| FE-009-10-05 | Git Hooks配置 | .husky/, lint-staged.config.js | - | - | - | ⏳ |
| FE-009-10-06 | 已有代码重构 | 所有Phase 1-4组件 | - | - | - | ⏳ |

## 依赖项

### 前置依赖
- **实现依赖**:
  - IMP-006: 工程编辑器整体布局与组件架构 ✅ (已完成实施计划)
- **功能依赖**:
  - FE-001: Scada主页面布局功能 ✅ (已实现)
  - FE-005: 自定义标题栏实现 ✅ (已实现)
- **外部依赖**:
  - React 18.3.1
  - MobX 6.12.0
  - mobx-react-lite 6.12.0
  - Electron 28
  - TypeScript 5.x

### 后置依赖
- **被依赖**:
  - 后续所有 Scada UI 功能
  - 工程保存与自动保存功能
  - 多工程并行编辑
- **影响范围**:
  - 影响所有 Scada 桌面应用的 UI 开发
  - 作为组件开发规范的基础

### 外部依赖

| 依赖名 | 版本 | 用途 | 许可证 |
|--------|------|------|--------|
| react | 18.3.1 | UI框架 | MIT |
| typescript | 5.x | 类型检查 | Apache 2.0 |
| mobx | 6.12.0 | 状态管理 | MIT |
| mobx-react-lite | 6.12.0 | MobX React集成 | MIT |
| react-dom | 18.3.1 | React DOM渲染 | MIT |
| @types/react | 18.x | React类型定义 | MIT |
| @types/react-dom | 18.x | React DOM类型定义 | MIT |
| eslint | 8.x | 代码检查 | MIT |
| prettier | 3.x | 代码格式化 | MIT |
| husky | 8.x | Git Hooks | MIT |
| lint-staged | 15.x | Git暂存文件检查 | MIT |
| jest | 29.x | 单元测试 | MIT |
| @testing-library/react | 14.x | React组件测试 | MIT |

## 测试策略

### 单元测试
- **覆盖率目标**: 80%
- **测试框架**: Jest + React Testing Library
- **关键测试用例**:
  - **Store测试**:
    - TabStore: addTab(), closeTab(), setActiveTab()
    - SubPageTabStore: addSubTab(), closeSubTab()
    - ToolbarStore: selectToolOption(), setSubToolbarMode()
    - LayoutStore: setEditOptionLayout()
  - **组件测试**:
    - TabBar: 标签渲染、点击、关闭
    - HomePage: 导航切换
    - EditorPage: 工具栏交互
    - SubPageTabBar: 内部标签管理

### 集成测试
- **测试场景**:
  - 打开工程流程（选择文件 → 创建标签 → 显示编辑器）
  - 标签切换流程（应用级 + 内部）
  - 工具栏交互流程（主工具栏 → 子工具栏 → 动态隐藏）
  - 编辑选项栏布局切换流程（左侧 ↔ 顶部）
  - 多标签管理场景（创建、切换、关闭）
- **测试工具**: Playwright (E2E)

### 验收测试
- **验收标准**:
  - [ ] 应用级标签栏正常工作
  - [ ] 首页和编辑器布局正确
  - [ ] 工具栏交互正常
  - [ ] 内部标签系统正常
  - [ ] 编辑选项栏布局可配置
  - [ ] 所有组件可独立复用
  - [ ] COMPONENT_STANDARDS.md 完整输出
  - [ ] 所有组件符合规范
  - [ ] 性能指标达标（标签切换 < 100ms）
  - [ ] 单元测试覆盖率 > 80%

## 依赖忽略记录

无依赖忽略（所有前置依赖已满足）。

## 实现日志

### 2026-01-28
- ✅ 创建 IMP-009 实施计划文档
- ✅ 完成任务分解（6个阶段，17个工作日）
- ✅ 设计代码映射表
- ✅ 识别依赖关系
- ⏳ 等待开始实施

## 问题记录

| 日期 | 问题描述 | 严重程度 | 解决方案 | 状态 | 责任人 |
|------|---------|---------|---------|------|--------|
| - | - | - | - | - |

## 代码审查

### 审查清单
- [ ] 代码符合项目规范
- [ ] 充分的注释和文档
- [ ] 错误处理完善
- [ ] 单元测试覆盖
- [ ] 性能考虑充分
- [ ] 安全检查通过

### 审查意见
| 审查人 | 日期 | 意见 | 状态 |
|--------|------|------|------|
| - | - | - | - |

## 验证记录

### 测试结果
- **单元测试**: ⏳ 待测试
- **集成测试**: ⏳ 待测试
- **性能测试**: ⏳ 待测试
- **安全扫描**: ⏳ 待测试

### 测试报告
待测试完成后添加。

## 部署计划

### 部署环境
- **开发环境**: ⏳ 待部署
- **测试环境**: ⏳ 待部署
- **预生产环境**: ⏳ 待部署
- **生产环境**: ⏳ 待部署

### 部署步骤
1. 代码审查通过
2. 合并到主分支
3. 构建桌面应用
4. 内部测试
5. 灰度发布
6. 正式发布

### 回滚计划
如果部署失败：
1. Git 回滚到上一版本
2. 重新构建桌面应用
3. 通知用户回退

## 文档更新

- [ ] COMPONENT_STANDARDS.md (规范文档)
- [ ] COMPONENT_CHECKLIST.md (检查清单)
- [ ] 组件开发模板 (templates/)
- [ ] 技术文档更新
- [ ] 用户手册更新
- [ ] 运维文档更新

## 变更历史
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2026-01-28 | 1.0 | 初始创建 | Claude (implementation-manager) |
