# IMP-006: Scada工程编辑器整体布局与组件架构实施计划

## 元数据
- **计划ID**: IMP-006
- **关联需求**: REQ-006
- **关联功能**: FE-006
- **技术方案**: SOL-006
- **状态**: 草案
- **制定人**: Claude
- **评审人**: 待定
- **创建日期**: 2026-01-23
- **目标完成日期**: 2026-02-13 (预估13-20个工作日)

## 概述

### 实施目标
基于 SOL-006 技术方案，实现 Scada 工程编辑器的完整功能，包括：
1. **前端UI层**: 14个React组件 + MobX状态管理
2. **Electron主进程层**: 7个功能模块 + IPC通信
3. **前后端集成**: 完整的文件操作、菜单、通知功能

### 技术栈
- **前端**: React 18.3.1, TypeScript 5.x, MobX 6.12.0, Vite 5.4.2
- **样式**: Plain CSS + CSS Variables
- **桌面**: Electron (版本根据项目现有)
- **测试**: Vitest + React Testing Library + Playwright

### 实施范围
- **前端组件**: 14个UI组件（EditorLayout, Toolbars, Sidebars, Canvas, Panels等）
- **主进程模块**: 7个模块（WindowManager, FileManager, MenuManager等）
- **状态管理**: 3个MobX Store（editorStore, projectStore, canvasStore）
- **IPC通道**: 11个通信通道
- **样式系统**: 扩展CSS变量，遵循STYLE_GUIDE.md

## 依赖分析

### 前置依赖
- **FE-001**: Scada主页面布局功能 ✅ 已完成
  - MainContent组件存在
  - TitleBar组件存在
  - Sidebar组件存在
- **FE-005**: 自定义TitleBar实现 ✅ 已完成
  - TitleBar已自定义
  - 可集成ProjectTab组件

### 外部依赖
- **React**: ^18.3.1
- **MobX**: ^6.12.0
- **TypeScript**: ^5.0.0
- **Electron**: (项目现有版本)
- **electron-store**: (新增，用于窗口状态和最近文件持久化)

### 无依赖项
- 本功能可以独立开发，不依赖其他FE
- 前端UI可以先用Mock数据开发
- Electron主进程可以并行开发

## 实施阶段划分

### 阶段1: 基础布局和状态管理 (P0)
**时间**: 2-3天
**目标**: 实现六区域布局和MobX状态管理架构

#### 任务分解

**Task 1.1: 创建项目目录结构** (预估: 0.5h)
- [ ] 创建 `platforms/scada/packages/renderer/src/components/editor/` 目录
- [ ] 创建子目录: `toolbar/`, `sidebar/`, `rightpanel/`, `tabs/`, `canvas/`, `statusbar/`
- [ ] 创建 `platforms/scada/packages/renderer/src/store/editor/` 目录
- [ ] 创建 `platforms/scada/packages/renderer/src/types/editor/` 目录
- [ ] 创建 `platforms/scada/packages/renderer/src/styles/editor.css`

**Task 1.2: 创建 MobX Store 架构** (预估: 2h)
- [ ] 创建 `editorStore.ts`
  - 状态: projectTabs, activeProjectTabId, leftSidebarActiveTab, rightPanelVisible, rightPanelActiveTab, selectedObjectIds, zoom
  - 操作: openProject, closeProject, switchProject, setLeftSidebarActiveTab, setRightPanelVisible, setRightPanelActiveTab, setSelectedObjects, setZoom
  - 派生: activeProjectTab, hasUnsavedChanges, canUndo
- [ ] 创建 `projectStore.ts`
  - 状态: currentProject, pages, components
  - 操作: createProject, openProject, saveProject, createPage, deletePage, renamePage, getComponentLibrary
  - 派生: currentPage, pageCount
- [ ] 创建 `canvasStore.ts`
  - 状态: currentPageId, canvasObjects, selectedObjectIds
  - 操作: setCurrentPage, addComponent, deleteObjects, selectObjects, updateObjectProperty, reorderLayers
  - 派生: currentPage, selectedObjects, layers
- [ ] 创建 `store/index.ts` 导出所有Store

**Task 1.3: 扩展CSS变量系统** (预估: 1h)
- [ ] 在 `editor.css` 中定义编辑器专用CSS变量
  - 布局尺寸: --editor-topbar-height, --editor-subtoolbar-height, --editor-sidebar-width, --editor-rightpanel-width, --editor-statusbar-height
  - 组件样式: --editor-tab-height, --editor-toolbar-button-size, --editor-icon-size
  - 颜色系统: 复用STYLE_GUIDE.md中的颜色变量
- [ ] 定义BEM命名规范
- [ ] 添加过渡动画变量

**Task 1.4: 创建 StatusBar 组件** (预估: 2h)
- [ ] 创建 `StatusBar.tsx` 和 `StatusBar.css`
- [ ] 实现状态信息显示（就绪/操作中/错误）
- [ ] 实现缩放控件（ZoomControls）
- [ ] 实现坐标信息显示（CoordinateInfo）
- [ ] 实现通知区域（Notifications）
- [ ] 集成到editorStore的zoom和状态信息

**Task 1.5: 创建 EditorLayout 主布局组件** (预估: 3h)
- [ ] 创建 `EditorLayout.tsx` 和 `EditorLayout.css`
- [ ] 实现六区域Flexbox布局
  - 顶部: TopToolbar区域 (32px)
  - 次顶部: SubToolbar区域 (64px)
  - 中间: Flex布局 (LeftSidebar | Canvas | RightPanel)
  - 底部: StatusBar (24px)
- [ ] 使用MobX observer包装组件
- [ ] 集成到MainContent，替换占位内容
- [ ] 测试布局响应式（窗口缩放）

**验收标准**:
- [ ] 目录结构完整
- [ ] 3个MobX Store可正常导入和使用
- [ ] CSS变量定义完整，可复用STYLE_GUIDE.md变量
- [ ] StatusBar显示正常
- [ ] EditorLayout六区域布局正确显示
- [ ] 窗口缩放时布局自适应

**产出物**:
- `platforms/scada/packages/renderer/src/components/editor/` (目录结构)
- `platforms/scada/packages/renderer/src/store/editorStore.ts`
- `platforms/scada/packages/renderer/src/store/projectStore.ts`
- `platforms/scada/packages/renderer/src/store/canvasStore.ts`
- `platforms/scada/packages/renderer/src/styles/editor.css`
- `platforms/scada/packages/renderer/src/components/editor/EditorLayout.tsx`
- `platforms/scada/packages/renderer/src/components/editor/statusbar/StatusBar.tsx`

---

### 阶段2: 工程标签页和导航栏 (P0)
**时间**: 2-3天
**目标**: 实现工程标签页管理和左侧导航栏

#### 任务分解

**Task 2.1: 创建 ProjectTab 组件** (预估: 3h)
- [ ] 创建 `ProjectTab.tsx` 和 `ProjectTab.css`
- [ ] 实现标签页显示（标题、图标、未保存标识）
- [ ] 实现标签页交互（点击切换、关闭按钮、右键菜单）
- [ ] 集成到TitleBar（修改FE-005的TitleBar组件）
- [ ] 连接editorStore的projectTabs状态
- [ ] Mock: 新建/打开工程时创建标签页
- [ ] Mock: 关闭标签页功能

**Task 2.2: 创建 LeftSidebar 容器和 SidebarTab** (预估: 2h)
- [ ] 创建 `LeftSidebar.tsx` 和 `LeftSidebar.css`
- [ ] 创建 `SidebarTab.tsx` 和 `SidebarTab.css`
- [ ] 实现3个Tab（工程、画面、组件）的切换
- [ ] 连接editorStore的leftSidebarActiveTab状态
- [ ] Tab样式: 默认/悬停/激活状态
- [ ] 测试Tab切换功能

**Task 2.3: 创建 ProjectPanel 组件** (预估: 3h)
- [ ] 创建 `ProjectPanel.tsx` 和 `ProjectPanel.css`
- [ ] 实现工程树形结构（Project → Pages → Components）
- [ ] Mock: 显示示例工程树
- [ ] 实现节点选中功能
- [ ] 连接projectStore的currentProject状态
- [ ] 实现展开/折叠功能

**Task 2.4: 创建 PagesPanel 组件** (预估: 2h)
- [ ] 创建 `PagesPanel.tsx` 和 `PagesPanel.css`
- [ ] 实现画面列表显示（PageThumbnail, PageName, PageStatus）
- [ ] Mock: 显示示例页面列表
- [ ] 实现页面选中功能
- [ ] 连接projectStore的pages状态

**Task 2.5: 创建 ComponentsPanel 组件** (预估: 2h)
- [ ] 创建 `ComponentsPanel.tsx` 和 `ComponentsPanel.css`
- [ ] 实现组件库网格布局
- [ ] Mock: 显示示例组件（矩形、圆形、文本、图片等）
- [ ] 实现组件拖拽功能（onDragStart）
- [ ] 连接projectStore的components状态

**Task 2.6: 实现 Tab 切换逻辑和状态同步** (预估: 2h)
- [ ] 确保SidebarTab切换时显示对应Panel
- [ ] 确保状态同步到MobX Store
- [ ] 测试切换流畅性
- [ ] 添加过渡动画

**验收标准**:
- [ ] ProjectTab在TitleBar中正常显示
- [ ] 可以创建/切换/关闭标签页（Mock功能）
- [ ] LeftSidebar 3个Tab正常切换
- [ ] ProjectPanel显示工程树（Mock数据）
- [ ] PagesPanel显示画面列表（Mock数据）
- [ ] ComponentsPanel显示组件库（Mock数据）
- [ ] 所有状态正确同步到MobX Store

**产出物**:
- `platforms/scada/packages/renderer/src/components/editor/tabs/ProjectTab.tsx`
- `platforms/scada/packages/renderer/src/components/editor/sidebar/LeftSidebar.tsx`
- `platforms/scada/packages/renderer/src/components/editor/sidebar/SidebarTab.tsx`
- `platforms/scada/packages/renderer/src/components/editor/sidebar/ProjectPanel.tsx`
- `platforms/scada/packages/renderer/src/components/editor/sidebar/PagesPanel.tsx`
- `platforms/scada/packages/renderer/src/components/editor/sidebar/ComponentsPanel.tsx`

---

### 阶段3: 工具栏和画布区域 (P0)
**时间**: 2-3天
**目标**: 实现顶部工具栏、子工具栏和画布区域

#### 任务分解

**Task 3.1: 创建 TopToolbar 和 ToolbarButton** (预估: 3h)
- [ ] 创建 `TopToolbar.tsx` 和 `TopToolbar.css`
- [ ] 创建 `ToolbarButton.tsx` 和 `ToolbarButton.css`
- [ ] 创建 `ToolbarGroup.tsx` 组件
- [ ] 定义工具栏按钮配置 `constants/toolbarItems.ts`
  - 文件操作组: 新建、打开、保存、另存为、导出
  - 编辑操作组: 撤销、重做、剪切、复制、粘贴、删除
  - 视图操作组: 放大、缩小、适应窗口、实际大小
  - 工具箱组: 选择、画线、画矩形、画圆形、文本、图片
- [ ] 实现按钮样式（默认/悬停/激活/禁用）
- [ ] Mock: 按钮点击事件（输出console.log）
- [ ] 工具提示（Tooltip）实现

**Task 3.2: 创建 SubToolbar** (预估: 2h)
- [ ] 创建 `SubToolbar.tsx` 和 `SubToolbar.css`
- [ ] 实现上下文相关工具控件
  - 颜色选择器（ColorPicker）
  - 下拉框（Select）
  - 按钮组（ButtonGroup）
- [ ] Mock: 根据选中对象显示不同控件
  - 选中矩形: 填充色、边框色、边框宽度、线型
  - 选中文本: 字体、字号、颜色、加粗/斜体/下划线
  - 画线工具: 线宽、线型、颜色、箭头样式

**Task 3.3: 创建 SubPageTabs** (预估: 2h)
- [ ] 创建 `SubPageTabs.tsx` 和 `SubPageTabs.css`
- [ ] 创建 `SubPageTab.tsx` 组件
- [ ] 实现页面标签切换
- [ ] 实现未保存标识（小圆点）
- [ ] 实现关闭按钮
- [ ] 连接projectStore的pages状态

**Task 3.4: 创建 CanvasArea 和 Canvas** (预估: 4h)
- [ ] 创建 `CanvasArea.tsx` 和 `CanvasArea.css`
- [ ] 创建 `Canvas.tsx` 和 `Canvas.css`
- [ ] 实现画布网格背景
- [ ] Mock: 显示示例组件（矩形、圆形）
- [ ] 实现组件选中功能（点击 → 高亮）
- [ ] 实现选中框（SelectionOverlay）
- [ ] 连接canvasStore的canvasObjects和selectedObjectIds状态
- [ ] 实现鼠标坐标追踪

**Task 3.5: 集成工具栏和画布** (预估: 1h)
- [ ] 将TopToolbar集成到EditorLayout
- [ ] 将SubToolbar集成到EditorLayout
- [ ] 将SubPageTabs集成到EditorLayout
- [ ] 将CanvasArea集成到EditorLayout
- [ ] 测试整体布局和交互

**验收标准**:
- [ ] TopToolbar显示所有按钮组
- [ ] 按钮样式正确（悬停、激活、禁用）
- [ ] SubToolbar根据选中对象显示不同控件
- [ ] SubPageTabs可以切换页面
- [ ] Canvas显示网格背景和示例组件
- [ ] 点击Canvas组件可以选中并高亮
- [ ] 状态栏显示鼠标坐标和缩放比例

**产出物**:
- `platforms/scada/packages/renderer/src/components/editor/toolbar/TopToolbar.tsx`
- `platforms/scada/packages/renderer/src/components/editor/toolbar/ToolbarButton.tsx`
- `platforms/scada/packages/renderer/src/components/editor/toolbar/ToolbarGroup.tsx`
- `platforms/scada/packages/renderer/src/components/editor/toolbar/SubToolbar.tsx`
- `platforms/scada/packages/renderer/src/constants/toolbarItems.ts`
- `platforms/scada/packages/renderer/src/components/editor/tabs/SubPageTabs.tsx`
- `platforms/scada/packages/renderer/src/components/editor/tabs/SubPageTab.tsx`
- `platforms/scada/packages/renderer/src/components/editor/canvas/CanvasArea.tsx`
- `platforms/scada/packages/renderer/src/components/editor/canvas/Canvas.tsx`

---

### 阶段4: 右侧属性栏 (P0)
**时间**: 2天
**目标**: 实现右侧属性栏、属性面板和图层面板

#### 任务分解

**Task 4.1: 创建 RightPanel 容器** (预估: 2h)
- [ ] 创建 `RightPanel.tsx` 和 `RightPanel.css`
- [ ] 实现动态显示/隐藏（根据editorStore.rightPanelVisible）
- [ ] 实现平滑过渡动画（margin-right: -280px → 0）
- [ ] 创建 `SidebarTab` 组件（属性 | 图层）
- [ ] 连接editorStore的rightPanelVisible和rightPanelActiveTab状态

**Task 4.2: 创建 PropertiesPanel** (预估: 4h)
- [ ] 创建 `PropertiesPanel.tsx` 和 `PropertiesPanel.css`
- [ ] 实现5个属性组:
  - 基本属性: 名称、位置(X, Y)、尺寸(W, H)、可见性、锁定
  - 外观属性: 背景色、边框色、边框宽度、透明度
  - 文本属性: 字体、字号、颜色（仅文本组件）
  - 数据属性: 数据绑定、变量关联
  - 事件属性: 点击事件、数据变更事件
- [ ] 创建 `PropertyGroup` 和 `PropertyField` 组件
- [ ] 实现表单控件（Input、Select、ColorPicker等）
- [ ] Mock: 属性修改时输出console.log
- [ ] 连接canvasStore的selectedObjects状态

**Task 4.3: 创建 LayersPanel** (预估: 3h)
- [ ] 创建 `LayersPanel.tsx` 和 `LayersPanel.css`
- [ ] 实现 `LayerItem` 组件
- [ ] 显示图层列表（图层可见性图标、锁定图标、图层名称）
- [ ] 实现图层拖拽排序（onReorder）
- [ ] 实现图层可见性切换（眼睛图标）
- [ ] 实现图层锁定切换（锁图标）
- [ ] Mock: 拖拽排序时输出console.log
- [ ] 连接canvasStore的layers状态

**Task 4.4: 实现选中对象时显示右侧属性栏** (预估: 1h)
- [ ] 在Canvas组件选中对象时设置editorStore.selectedObjectIds
- [ ] 在editorStore中添加computed: selectedObjectIds.length > 0 ? rightPanelVisible = true
- [ ] 测试选中/取消选中时右侧面板显示/隐藏

**Task 4.5: Mock 功能实现** (预估: 1h)
- [ ] PropertiesPanel: 属性修改后更新canvasStore（Mock）
- [ ] LayersPanel: 拖拽排序后更新canvasStore.layers（Mock）
- [ ] 测试状态同步

**验收标准**:
- [ ] RightPanel默认隐藏
- [ ] 选中Canvas对象时RightPanel平滑显示
- [ ] 取消选中时RightPanel平滑隐藏
- [ ] PropertiesPanel显示选中对象的所有属性
- [ ] LayersPanel显示所有图层
- [ ] 可以切换"属性"和"图层"Tab
- [ ] 属性和图层修改时状态同步到MobX Store（Mock）

**产出物**:
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/RightPanel.tsx`
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/PropertiesPanel.tsx`
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/LayersPanel.tsx`
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/PropertyGroup.tsx`
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/PropertyField.tsx`
- `platforms/scada/packages/renderer/src/components/editor/rightpanel/LayerItem.tsx`

---

### 阶段5: Electron 主进程集成 (P0)
**时间**: 3-4天
**目标**: 实现 Electron 主进程功能，打通前后端通信

#### 任务分解

**Task 5.1: 创建主进程目录结构** (预估: 0.5h)
- [ ] 确保 `platforms/scada/packages/main/src/` 目录存在
- [ ] 创建主进程模块文件

**Task 5.2: 创建 WindowManager** (预估: 2h)
- [ ] 创建 `windowManager.ts`
- [ ] 实现 `createMainWindow()` 方法
  - 窗口尺寸: 1400x900
  - 最小尺寸: 1200x700
  - backgroundColor: #f5f5f5
  - show: false (延迟显示)
  - webPreferences: contextIsolation, preload
- [ ] 实现 `saveWindowState()` 方法
  - 保存窗口尺寸、位置、最大化状态
  - 使用 electron-store 持久化
- [ ] 实现 `restoreWindowState()` 方法
- [ ] 在窗口关闭时自动保存状态
- [ ] 在应用启动时恢复窗口状态

**Task 5.3: 创建 FileManager** (预估: 3h)
- [ ] 创建 `fileManager.ts`
- [ ] 实现 `openProjectFile()` 方法
  - 使用 dialog.showOpenDialog
  - 文件过滤器: .scada, .json
  - 使用 fs.readFile 读取文件
  - 解析 JSON，添加 filePath 字段
- [ ] 实现 `saveProjectFile()` 方法
  - 使用 fs.writeFile 保存文件
  - 移除 filePath 字段后再保存
  - 返回 success: boolean
- [ ] 实现 `showSaveFileDialog()` 方法
  - 使用 dialog.showSaveDialog
  - 文件过滤器: .scada, .json
- [ ] 错误处理: 文件不存在、权限不足、JSON解析失败

**Task 5.4: 创建 MenuManager** (预估: 3h)
- [ ] 创建 `menuManager.ts`
- [ ] 实现 `createApplicationMenu()` 方法
  - 文件菜单: 新建工程、打开工程、保存、另存为、最近打开、退出
  - 编辑菜单: 撤销、重做、剪切、复制、粘贴、删除、全选
  - 视图菜单: 放大、缩小、适应窗口、显示/隐藏左侧面板、显示/隐藏右侧面板
  - 工具菜单: 组件库、设置
  - 帮助菜单: 文档、关于
- [ ] 实现 `sendCommandToRenderer()` 方法
  - 使用 webContents.send 发送菜单命令
- [ ] 实现 `createRecentFilesMenu()` 方法
  - 从 electron-store 读取最近文件列表
  - 动态生成菜单项
- [ ] 定义快捷键（accelerator）
  - CmdOrCtrl+N: 新建工程
  - CmdOrCtrl+O: 打开工程
  - CmdOrCtrl+S: 保存
  - CmdOrCtrl+Shift+S: 另存为

**Task 5.5: 创建 NotificationManager** (预估: 1.5h)
- [ ] 创建 `notificationManager.ts`
- [ ] 实现 `showNotification()` 方法
  - 使用 Electron Notification API
  - 支持类型: info, success, warning, error
  - 设置 urgency: normal, critical, low
  - 设置图标: 根据类型选择不同图标
- [ ] 准备图标文件: success.png, error.png, warning.png, info.png

**Task 5.6: 创建 AutoSaveManager** (预估: 1.5h)
- [ ] 创建 `autoSaveManager.ts`
- [ ] 实现 `startAutoSave()` 方法
  - 定时器: 5分钟 (300000ms)
  - 发送 'project:autosave' 事件到 Renderer
- [ ] 实现 `stopAutoSave()` 方法
- [ ] 实现 `setAutoSaveEnabled()` 方法
- [ ] 在应用启动时启动自动保存
- [ ] 在应用退出时停止自动保存

**Task 5.7: 注册所有 IPC Handlers** (预估: 2h)
- [ ] 修改 `platforms/scada/packages/main/src/index.ts`
- [ ] 注册工程文件操作 IPC:
  - `ipcMain.handle('project:open')`
  - `ipcMain.handle('project:save')`
  - `ipcMain.handle('project:save-as')`
- [ ] 注册文件对话框 IPC:
  - `ipcMain.handle('dialog:open-file')`
  - `ipcMain.handle('dialog:save-file')`
- [ ] 注册窗口状态 IPC:
  - `ipcMain.handle('window:get-state')`
  - `ipcMain.handle('window:set-state')`
- [ ] 注册最近文件 IPC:
  - `ipcMain.handle('recent-files:get')`
  - `ipcMain.handle('recent-files:add')`
- [ ] 注册系统通知 IPC:
  - `ipcMain.handle('notification:show')`
- [ ] 初始化所有 Manager 实例
- [ ] 在 app.whenReady() 中设置应用菜单

**Task 5.8: 创建 Preload 脚本** (预估: 2h)
- [ ] 创建 `platforms/scada/packages/main/preload/index.ts`
- [ ] 使用 contextBridge 暴露 API:
  - openProject, saveProject, saveProjectAs
  - openFileDialog, saveFileDialog
  - getWindowState, setWindowState
  - getRecentFiles, addRecentFile
  - showNotification
  - onMenuCommand, onAutoSave
- [ ] 定义 TypeScript 接口 ElectronAPI
- [ ] 添加类型声明到 global Window 接口
- [ ] 确保 contextIsolation 和 nodeIntegration 配置正确

**Task 5.9: 前端 MobX Store 集成 IPC** (预估: 3h)
- [ ] 修改 `editorStore.ts`
  - 在 `openProject()` 中调用 `window.electronAPI.openProject()`
  - 在 `saveProject()` 中调用 `window.electronAPI.saveProject()`
  - 错误处理: 显示错误通知
- [ ] 修改 `projectStore.ts`
  - 在 `createProject()` 中调用 IPC
  - 在 `openProject()` 中调用 IPC
  - 在 `saveProject()` 中调用 IPC
- [ ] 添加 IPC 调用的 loading 状态
- [ ] 测试 IPC 通信流程

**Task 5.10: 实现工具栏按钮的真实文件操作** (预估: 2h)
- [ ] TopToolbar "新建" 按钮: 调用 projectStore.createProject()
- [ ] TopToolbar "打开" 按钮: 调用 editorStore.openProject() → IPC openFileDialog
- [ ] TopToolbar "保存" 按钮: 调用 editorStore.saveProject() → IPC saveProject
- [ ] TopToolbar "另存为" 按钮: 调用 IPC saveFileDialog → saveProject
- [ ] 测试文件操作完整流程

**Task 5.11: 实现菜单命令监听和响应** (预估: 2h)
- [ ] 在 EditorLayout 或 App 组件中监听菜单命令
  - `window.electronAPI.onMenuCommand((command) => { ... })`
- [ ] 实现命令处理逻辑:
  - 'project:new': 创建新工程
  - 'project:open': 打开工程
  - 'project:save': 保存工程
  - 'view:zoom-in': 放大画布
  - 'view:zoom-out': 缩小画布
  - 'view:toggle-left-sidebar': 切换左侧面板
  - 'view:toggle-right-panel': 切换右侧面板
- [ ] 测试菜单命令

**Task 5.12: 实现最近文件列表显示和打开** (预估: 2h)
- [ ] 在HomePage或RecentProjects组件中调用 `getRecentFiles()`
- [ ] 显示最近文件列表
- [ ] 点击最近文件时调用 `openProject(filePath)`
- [ ] 测试最近文件功能

**Task 5.13: 测试 IPC 通信完整流程** (预估: 2h)
- [ ] 测试打开工程文件
- [ ] 测试保存工程文件
- [ ] 测试另存为
- [ ] 测试最近文件
- [ ] 测试菜单命令
- [ ] 测试系统通知
- [ ] 测试窗口状态持久化
- [ ] 测试自动保存
- [ ] 边界情况测试:
  - 文件不存在
  - 权限不足
  - JSON格式错误
  - 取消操作

**验收标准**:
- [ ] 窗口状态正确保存和恢复
- [ ] 可以打开工程文件（.scada, .json）
- [ ] 可以保存工程文件
- [ ] 应用菜单显示正确
- [ ] 菜单快捷键工作正常
- [ ] 系统通知正确显示
- [ ] 自动保存功能正常（5分钟间隔）
- [ ] IPC 通信无错误
- [ ] Preload 脚本类型安全
- [ ] 工具栏按钮触发真实文件操作
- [ ] 菜单命令正确响应
- [ ] 最近文件列表显示和打开正常

**产出物**:
- `platforms/scada/packages/main/src/windowManager.ts`
- `platforms/scada/packages/main/src/fileManager.ts`
- `platforms/scada/packages/main/src/menuManager.ts`
- `platforms/scada/packages/main/src/notificationManager.ts`
- `platforms/scada/packages/main/src/autoSaveManager.ts`
- `platforms/scada/packages/main/src/index.ts` (更新)
- `platforms/scada/packages/main/preload/index.ts`
- `platforms/scada/packages/renderer/src/store/editorStore.ts` (更新)
- `platforms/scada/packages/renderer/src/store/projectStore.ts` (更新)
- 图标文件: success.png, error.png, warning.png, info.png

---

### 阶段6: 集成和优化 (P1)
**时间**: 2-3天
**目标**: 集成所有组件（前端+后端），优化交互和样式

#### 任务分解

**Task 6.1: 集成所有前端组件到 EditorLayout** (预估: 2h)
- [ ] 确保所有14个组件都正确导入
- [ ] 确保所有组件都连接到对应的 MobX Store
- [ ] 测试组件间的状态同步
- [ ] 修复任何集成问题

**Task 6.2: 集成 Electron 主进程功能** (预估: 2h)
- [ ] 确保所有 IPC 通道正常工作
- [ ] 确保前端和后端状态同步
- [ ] 测试完整的文件操作流程
- [ ] 修复任何集成问题

**Task 6.3: 实现组件间状态同步** (预估: 2h)
- [ ] 测试: ProjectTab 切换 → EditorLayout 显示对应工程
- [ ] 测试: LeftSidebar Tab 切换 → 显示对应 Panel
- [ ] 测试: Canvas 选中对象 → RightPanel 显示属性
- [ ] 测试: 修改属性 → Canvas 实时更新
- [ ] 测试: SubPageTabs 切换 → Canvas 显示对应页面

**Task 6.4: 实现前后端状态同步** (预估: 2h)
- [ ] 测试: 打开工程 → ProjectTab 创建 → 编辑器显示内容
- [ ] 测试: 保存工程 → ProjectTab 未保存标识清除 → 通知显示
- [ ] 测试: 菜单命令 → 前端响应
- [ ] 测试: 最近文件 → 点击打开
- [ ] 测试: 自动保存 → 前端接收事件

**Task 6.5: 优化样式，遵循 STYLE_GUIDE.md** (预估: 3h)
- [ ] 检查所有组件是否符合 STYLE_GUIDE.md 规范
- [ ] 统一颜色使用（复用 CSS 变量）
- [ ] 统一间距（8px网格）
- [ ] 统一圆角（4px标准，2px小元素）
- [ ] 统一过渡动画（150ms fast, 250ms normal）
- [ ] 确保字体大小符合规范（11px-16px）

**Task 6.6: 添加悬停效果和过渡动画** (预估: 2h)
- [ ] ToolbarButton: hover, active 状态
- [ ] SidebarTab: hover, active 状态
- [ ] RightPanel: 显示/隐藏过渡动画
- [ ] PropertyField: focus 状态
- [ ] 所有可交互元素添加视觉反馈

**Task 6.7: 实现响应式布局** (预估: 2h)
- [ ] 测试窗口缩放时布局自适应
- [ ] 侧边栏在窄屏幕时缩小宽度（240px）
- [ ] Canvas区域自适应剩余空间
- [ ] 测试最小窗口尺寸（1200x700）

**Task 6.8: 性能优化** (预估: 3h)
- [ ] 使用 React.memo 优化 ToolbarButton, PropertyField 等组件
- [ ] 使用 useMemo 缓存计算结果
- [ ] 使用 useCallback 缓存回调函数
- [ ] MobX Store 使用 computed 派生状态
- [ ] 测试性能指标:
  - 组件首次渲染 < 100ms
  - 状态更新响应 < 16ms (60fps)
  - IPC 调用往返 < 10ms

**Task 6.9: 窗口状态持久化测试** (预估: 1h)
- [ ] 测试窗口位置保存
- [ ] 测试窗口尺寸保存
- [ ] 测试最大化状态保存
- [ ] 重启应用后状态恢复

**Task 6.10: 文件操作边界情况测试** (预估: 2h)
- [ ] 测试文件不存在
- [ ] 测试权限不足
- [ ] 测试JSON格式错误
- [ ] 测试文件过大
- [ ] 测试取消操作
- [ ] 测试同名文件覆盖

**验收标准**:
- [ ] 所有组件集成无错误
- [ ] 前后端通信正常
- [ ] 组件间状态同步流畅
- [ ] 样式符合 STYLE_GUIDE.md
- [ ] 悬停效果和过渡动画流畅
- [ ] 响应式布局正常
- [ ] 性能指标达标
- [ ] 窗口状态持久化正常
- [ ] 文件操作边界情况处理正确

**产出物**:
- 完整的前端+后端集成
- 优化的样式系统
- 性能测试报告

---

## 代码实现映射表

### 前端组件映射

| 功能ID | 功能点 | 文件路径 | 类/组件 | 预估行号 | 状态 |
|--------|--------|---------|---------|---------|------|
| **阶段1: 基础布局和状态管理** |
| FE-006-15 | MobX Store架构 | src/store/editor/editorStore.ts | EditorStore | 1-150 | ⏳ |
| FE-006-15 | MobX Store架构 | src/store/editor/projectStore.ts | ProjectStore | 1-120 | ⏳ |
| FE-006-15 | MobX Store架构 | src/store/editor/canvasStore.ts | CanvasStore | 1-130 | ⏳ |
| FE-006-16 | CSS变量系统 | src/styles/editor.css | - | 1-200 | ⏳ |
| FE-006-14 | StatusBar | components/editor/statusbar/StatusBar.tsx | StatusBar | 1-100 | ⏳ |
| FE-006-02 | EditorLayout | components/editor/EditorLayout.tsx | EditorLayout | 1-150 | ⏳ |
| **阶段2: 工程标签页和导航栏** |
| FE-006-01 | ProjectTab | components/editor/tabs/ProjectTab.tsx | ProjectTab | 1-120 | ⏳ |
| FE-006-05 | LeftSidebar | components/editor/sidebar/LeftSidebar.tsx | LeftSidebar | 1-80 | ⏳ |
| FE-006-05 | SidebarTab | components/editor/sidebar/SidebarTab.tsx | SidebarTab | 1-60 | ⏳ |
| FE-006-06 | ProjectPanel | components/editor/sidebar/ProjectPanel.tsx | ProjectPanel | 1-100 | ⏳ |
| FE-006-07 | PagesPanel | components/editor/sidebar/PagesPanel.tsx | PagesPanel | 1-80 | ⏳ |
| FE-006-08 | ComponentsPanel | components/editor/sidebar/ComponentsPanel.tsx | ComponentsPanel | 1-100 | ⏳ |
| **阶段3: 工具栏和画布区域** |
| FE-006-03 | TopToolbar | components/editor/toolbar/TopToolbar.tsx | TopToolbar | 1-120 | ⏳ |
| FE-006-03 | ToolbarButton | components/editor/toolbar/ToolbarButton.tsx | ToolbarButton | 1-60 | ⏳ |
| FE-006-03 | ToolbarGroup | components/editor/toolbar/ToolbarGroup.tsx | ToolbarGroup | 1-50 | ⏳ |
| FE-006-04 | SubToolbar | components/editor/toolbar/SubToolbar.tsx | SubToolbar | 1-80 | ⏳ |
| FE-006-12 | SubPageTabs | components/editor/tabs/SubPageTabs.tsx | SubPageTabs | 1-80 | ⏳ |
| FE-006-12 | SubPageTab | components/editor/tabs/SubPageTab.tsx | SubPageTab | 1-60 | ⏳ |
| FE-006-13 | CanvasArea | components/editor/canvas/CanvasArea.tsx | CanvasArea | 1-60 | ⏳ |
| FE-006-13 | Canvas | components/editor/canvas/Canvas.tsx | Canvas | 1-150 | ⏳ |
| **阶段4: 右侧属性栏** |
| FE-006-09 | RightPanel | components/editor/rightpanel/RightPanel.tsx | RightPanel | 1-80 | ⏳ |
| FE-006-10 | PropertiesPanel | components/editor/rightpanel/PropertiesPanel.tsx | PropertiesPanel | 1-200 | ⏳ |
| FE-006-10 | PropertyGroup | components/editor/rightpanel/PropertyGroup.tsx | PropertyGroup | 1-60 | ⏳ |
| FE-006-10 | PropertyField | components/editor/rightpanel/PropertyField.tsx | PropertyField | 1-80 | ⏳ |
| FE-006-11 | LayersPanel | components/editor/rightpanel/LayersPanel.tsx | LayersPanel | 1-100 | ⏳ |
| FE-006-11 | LayerItem | components/editor/rightpanel/LayerItem.tsx | LayerItem | 1-80 | ⏳ |

### 主进程模块映射

| 功能ID | 功能点 | 文件路径 | 类/组件 | 预估行号 | 状态 |
|--------|--------|---------|---------|---------|------|
| **阶段5: Electron 主进程集成** |
| Main-001 | WindowManager | packages/main/src/windowManager.ts | WindowManager | 1-150 | ⏳ |
| Main-002 | FileManager | packages/main/src/fileManager.ts | FileManager | 1-180 | ⏳ |
| Main-003 | MenuManager | packages/main/src/menuManager.ts | MenuManager | 1-250 | ⏳ |
| Main-004 | NotificationManager | packages/main/src/notificationManager.ts | NotificationManager | 1-80 | ⏳ |
| Main-005 | AutoSaveManager | packages/main/src/autoSaveManager.ts | AutoSaveManager | 1-60 | ⏳ |
| Main-006 | IPC Handlers | packages/main/src/index.ts | registerIPCHandlers | 1-200 | ⏳ |
| Main-007 | Preload | packages/main/preload/index.ts | - | 1-100 | ⏳ |

### 常量和类型定义映射

| 功能ID | 功能点 | 文件路径 | 类/组件 | 预估行号 | 状态 |
|--------|--------|---------|---------|---------|------|
| FE-006-03 | 工具栏配置 | src/constants/toolbarItems.ts | - | 1-100 | ⏳ |
| FE-006-08 | 组件库配置 | src/constants/componentLibrary.ts | - | 1-150 | ⏳ |
| FE-006-00 | 编辑器类型定义 | src/types/editor/index.ts | - | 1-200 | ⏳ |
| FE-006-00 | 工程类型定义 | src/types/editor/project.ts | - | 1-80 | ⏳ |
| FE-006-00 | 画布类型定义 | src/types/editor/canvas.ts | - | 1-100 | ⏳ |

---

## 测试策略

### 单元测试

**前端组件测试**:
- [ ] MobX Store 测试
  - editorStore: 所有 actions 和 computed
  - projectStore: 所有 actions 和 computed
  - canvasStore: 所有 actions 和 computed
- [ ] 纯组件测试
  - ToolbarButton: 点击、样式、状态
  - PropertyField: 输入、变更事件
  - LayerItem: 拖拽、可见性、锁定
- [ ] 工具函数测试
  - 格式化函数
  - 验证函数

**主进程测试**:
- [ ] WindowManager: 窗口创建、状态保存和恢复
- [ ] FileManager: 文件读取、写入、对话框
- [ ] MenuManager: 菜单创建和命令发送
- [ ] NotificationManager: 通知显示
- [ ] IPC Handlers: 所有 IPC 通道的请求和响应

**测试工具**: Vitest + React Testing Library + Spectron/Playwright

### 集成测试

**前端集成测试**:
1. 打开工程 → 验证EditorLayout显示正确
2. 点击左侧Tab → 验证面板切换正确
3. 选中画布对象 → 验证右侧属性栏显示
4. 修改属性 → 验证状态同步到Store
5. 切换标签页 → 验证状态正确恢复
6. 切换页面 → 验证Canvas更新

**前后端集成测试**:
7. IPC 通信测试: 验证前端和主进程之间的 IPC 调用正常
8. 文件操作测试: 验证打开/保存工程文件的完整流程
9. 菜单命令测试: 验证菜单点击后前端正确响应
10. 窗口状态测试: 验证窗口状态持久化

**测试工具**: Vitest + React Testing Library + Playwright for Electron

### 视觉回归测试

- [ ] 组件样式截图对比
- [ ] 布局尺寸验证
- [ ] 响应式布局验证
- [ ] 悬停效果验证

**测试工具**: Playwright (可选，P2优先级)

### 测试覆盖率目标

- [ ] 前端组件: 70%+
- [ ] MobX Store: 90%+
- [ ] 主进程模块: 80%+
- [ ] 关键路径: 100%

---

## 风险和缓解措施

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| **组件数量多，开发周期长** | 高 | 中 | 优先实现P0功能，P1功能分阶段开发；使用组件库加速开发 |
| **MobX状态管理复杂度高** | 中 | 中 | 设计清晰的Store结构；编写详细的Store文档；编写单元测试 |
| **Electron IPC通信调试困难** | 中 | 中 | 使用Electron DevTools；编写详细的IPC文档；建立完善的错误处理和日志记录 |
| **文件操作边界情况多** | 中 | 中 | 编写完整的单元测试覆盖边界情况；提供友好的错误提示；实现文件备份机制 |
| **跨平台兼容性** | 中 | 中 | 使用Electron API的跨平台封装；在三大平台进行测试；处理平台特定差异 |
| **右侧属性栏动态显示导致布局跳动** | 中 | 低 | 使用CSS transition实现平滑动画；预留固定空间避免布局重排 |
| **性能问题：组件渲染慢** | 中 | 低 | 使用React.memo优化重渲染；使用虚拟滚动（如需要）；MobX精确响应 |
| **16个子组件的样式一致性难以保证** | 中 | 低 | 严格遵循STYLE_GUIDE.md；使用CSS Variables统一管理样式；建立样式Review机制 |

---

## 实施日志

### 2026-01-23
- ✅ 创建 IMP-006 实施计划文档
- ✅ 定义6个实施阶段
- ✅ 分解所有任务（60+个任务）
- ✅ 设计代码映射表
- ✅ 定义测试策略
- ⏳ 准备开始阶段1实施

---

## 成功标准

### 功能完整性
- [ ] 所有14个前端组件实现完成
- [ ] 所有7个主进程模块实现完成
- [ ] 所有11个IPC通道实现完成
- [ ] 所有3个MobX Store实现完成
- [ ] 前后端集成完成

### 质量标准
- [ ] 单元测试覆盖率达标（前端70%+，Store 90%+，主进程80%+）
- [ ] 集成测试全部通过
- [ ] 无关键Bug
- [ ] 样式符合 STYLE_GUIDE.md
- [ ] 性能指标达标

### 可维护性
- [ ] 代码注释完整
- [ ] 代码映射表更新
- [ ] 文档完整
- [ ] 代码可读性良好

### 用户体验
- [ ] 界面流畅，无卡顿
- [ ] 交互反馈清晰
- [ ] 错误提示友好
- [ ] 响应式布局正常

---

## 下一步行动

1. **开始阶段1实施** (2-3天)
   - 创建目录结构
   - 实现 MobX Store 架构
   - 实现 EditorLayout 和 StatusBar
   - 扩展CSS变量系统

2. **代码映射跟踪**
   - 实时更新 feature-to-code-map.md
   - 记录每日实施日志

3. **持续验证**
   - 每个阶段完成后进行验收
   - 单元测试和集成测试并行
   - 及时修复Bug

---

**附录**:
- 技术方案: SOL-006
- 功能需求: FE-006
- 原始需求: REQ-006
- 用户故事: US-006
