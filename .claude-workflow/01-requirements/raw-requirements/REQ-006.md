# REQ-006: 工程配置及编辑功能

## 需求信息

**需求ID**: REQ-006
**需求标题**: 工程配置及编辑功能
**需求来源**: 用户
**创建日期**: 2026-01-23
**目标平台**: Scada
**优先级**: 高 (P0)
**状态**: 📋 进行中

## 需求描述

实现Scada平台的工程配置及编辑界面，为用户提供完整的HMI工程编辑能力。当用户完成新建工程或从文件打开工程后，打开新的标签页显示工程名称，标签页内容为工程编辑界面。

## 业务价值

1. **提升生产力**: 提供专业的工程编辑环境，支持高效的HMI工程配置
2. **多工程管理**: 通过标签页机制支持同时编辑多个工程
3. **组件化架构**: 模块化的界面设计，便于后续功能扩展
4. **工业级体验**: 参考WPS、Visio等专业软件的交互模式，降低学习成本

## 功能需求

### 1. 标签页管理

#### 1.1 工程标签页创建
- **触发时机**:
  - 用户完成"新建工程"操作
  - 用户从文件打开现有工程
- **标签页显示**:
  - 标签页标题显示工程名称
  - 标签页图标显示工程类型图标
- **标签页行为**:
  - 支持多工程同时打开（多标签页）
  - 点击标签页切换到对应工程
  - 支持关闭标签页
  - 支持标签页拖拽排序（可选）

#### 1.2 标签页状态管理
- **活动标签页**: 当前编辑的工程标签页高亮显示
- **未保存标识**: 工程有未保存修改时，标签页显示标识
- **标签页切换**: 保存每个标签页的编辑状态

### 2. 工程编辑器整体布局

参考原型图: `asset/FE-006-整体布局的原型图-1.png`

#### 2.1 布局结构
工程编辑器采用**六区域布局**:

```
┌─────────────────────────────────────────────────────────┐
│  顶部工具导航栏 (Top Toolbar)                            │
│  文件操作 | 编辑工具 | 视图控制 | 工具箱                  │
├─────────────────────────────────────────────────────────┤
│  子工具栏 (Sub Toolbar)                                  │
│  上下文相关的快捷操作                                      │
├──────────┬─────────────────────────────┬─────────────────┤
│          │  子页面标签栏 (Sub-Page Tabs)│                 │
│  左侧    │  [页面1] [页面2] [页面3] ...  │   右侧属性栏    │
│  导航栏  ├─────────────────────────────┤ (Right Panel)   │
│          │                             │                 │
│ (Left   │       子页面内容区             │  - 属性面板     │
│ Sidebar)│    (Sub-Page Content)        │  - 图层面板     │
│          │                             │                 │
│ - 工程   │                             │  (当选中编辑页  │
│ - 画面   │                             │   面中的对象时  │
│ - 组件   │                             │   显示)         │
├──────────┴─────────────────────────────┴─────────────────┤
│  底部状态栏 (Status Bar)                                 │
│  状态信息 | 缩放控制 | 坐标信息 | 通知                    │
└─────────────────────────────────────────────────────────┘
```

#### 2.2 尺寸规范
- **顶部工具导航栏**: 高度 32px
- **子工具栏**: 高度 64px
- **左侧导航栏**: 宽度 280px（可调整）
- **右侧属性栏**: 宽度 280px（可调整，默认隐藏，选中对象时显示）
- **子页面标签栏**: 高度 36px
- **底部状态栏**: 高度 24px
- **主内容区**: 占据剩余空间

### 3. 顶部工具导航栏 (Top Toolbar)

参考图: `asset/FE-006-工具栏参考-样式和图标-WPS.png`, `asset/FE-006-工具栏参考-WL.png`

#### 3.1 功能分组
工具栏按功能分组，每组包含相关操作:

**文件操作组**:
- 新建工程
- 打开工程
- 保存工程
- 另存为
- 导出
- 打印预览
- 打印

**编辑操作组**:
- 撤销 (Undo)
- 重做 (Redo)
- 剪切
- 复制
- 粘贴
- 删除
- 全选

**视图操作组**:
- 缩放放大
- 缩放缩小
- 适应窗口
- 实际大小
- 网格显示开关
- 标尺显示开关

**工具箱组**:
- 选择工具
- 画线工具
- 画矩形工具
- 画圆形工具
- 文本工具
- 图片工具
- 数据绑定工具

#### 3.2 样式规范
- **按钮样式**:
  - 默认: 透明背景, 灰色图标
  - 悬停: 浅灰背景 #f0f0f0
  - 激活/按下: 工业蓝背景 #2196F3, 白色图标
  - 禁用: 透明背景, 浅灰图标, 不可点击
- **图标尺寸**: 20×20px
- **按钮间距**: 4px
- **组间距**: 16px（使用分隔线）
- **高度**: 40px
- **提示**: 悬停显示工具提示（Tooltip）

### 4. 子工具栏 (Sub Toolbar)

#### 4.1 功能描述
子工具栏显示**上下文相关的快捷操作**，根据当前选中的对象或工具动态变化。

#### 4.2 场景示例

**场景1 - 选中矩形组件时**:
- 填充颜色选择器
- 边框颜色选择器
- 边框宽度选择器
- 线型选择器（实线/虚线/点线）
- 位置调整（前移/后移/置顶/置底）

**场景2 - 选中文本组件时**:
- 字体选择器
- 字号选择器
- 字体颜色
- 加粗/斜体/下划线
- 对齐方式（左/中/右）

**场景3 - 画线工具激活时**:
- 线宽选择器
- 线型选择器
- 颜色选择器
- 箭头样式（无/开始/结束/双向）

#### 4.3 样式规范
- **高度**: 32px
- **背景**: 略深于主背景 #f8f8f8
- **与主工具栏区分**: 使用边框分隔或颜色区分
- **控件样式**: 紧凑型表单控件（下拉框、颜色选择器等）

### 5. 左侧导航栏 (Left Sidebar)

参考图: `asset/FE-006-左侧导航栏参考-FY.png.png`

#### 5.1 导航栏结构
左侧导航栏采用**多Tab切换模式**，每个Tab显示不同的面板内容。

**Tab列表**:
1. **工程 (Project)**: 工程树形结构，显示工程的页面和组件
2. **画面 (Pages)**: HMI画面/页面管理，显示当前工程的所有画面
3. **组件 (Components)**: 可用组件库，显示可拖拽的组件

#### 5.2 Tab样式规范
- **Tab高度**: 32px
- **Tab样式**:
  - 默认: 浅灰背景, 灰色文字
  - 悬停: 中灰背景
  - 激活: 工业蓝背景 #2196F3, 白色文字
- **Tab位置**: 垂直排列在导航栏顶部
- **Tab图标**: 16×16px SVG图标 + 文字标签

#### 5.3 各Tab内容规范

**Tab 1 - 工程 (Project)**:
- **功能**: 显示工程树形结构，管理工程、页面、组件的层级关系
- **内容**:
  - 根节点: 工程名称
  - 子节点: 页面列表（Page 1, Page 2, ...）
  - 页面子节点: 该页面上的所有组件
- **交互**:
  - 点击节点选中对应对象（选中后在右侧属性栏显示属性）
  - 双击页面节点切换到该页面
  - 右键菜单: 新建/删除/重命名/复制
  - 支持拖拽调整组件层级
- **展开/折叠**: 支持树节点的展开和折叠

**Tab 2 - 画面 (Pages)**:
- **功能**: HMI画面/页面管理，显示当前工程的所有画面列表
- **内容**:
  - 画面缩略图列表（可选）
  - 画面名称列表
  - 画面状态（已保存/未保存）
- **交互**:
  - 单击选中画面（选中后在画布区显示该画面内容）
  - 双击画面切换到该画面的编辑视图
  - 右键菜单: 新建画面、删除画面、重命名画面、复制画面
  - 拖拽调整画面顺序
  - 画面锁定/解锁
- **操作按钮**: 新建画面按钮（顶部工具栏或面板底部）

**Tab 3 - 组件 (Components)**:
- **功能**: 显示可拖拽的组件库
- **内容**:
  - 基础组件: 按钮、开关、指示灯、文本、图片
  - 输入组件: 输入框、下拉框、日期选择器
  - 图表组件: 折线图、柱状图、饼图
  - 高级组件: 表格、树形控件、选项卡
- **展示**: 网格布局 + 组件图标 + 名称
- **交互**: 拖拽组件到画布创建实例
- **搜索**: 组件搜索框（可选）

#### 5.4 样式规范
- **宽度**: 280px（可调整，支持拖拽改变宽度）
- **背景**: 白色 #ffffff
- **边框**: 右侧边框 1px solid #d0d0d0
- **内边距**: 12px
- **内容区高度**: 动态（总高度 - Tab栏高度 - 底部状态栏高度）

### 6. 右侧属性栏 (Right Properties Panel)

#### 6.1 功能描述
右侧属性栏在选中编辑页面中的对象时显示，包含属性面板和图层面板。未选中对象时，该区域可以隐藏或显示帮助信息。

#### 6.2 显示规则
- **默认状态**: 未选中对象时，面板可以隐藏或显示空状态提示
- **选中对象时**: 显示属性面板和图层面板
- **选中多个对象**: 显示公共属性
- **切换选中**: 面板内容动态更新

#### 6.3 属性面板 (Properties Panel)

**功能**: 编辑选中对象的属性

**布局**:
- 垂直Tab切换（属性 | 图层）
- 两列表单布局（标签 + 输入控件）
- 分类折叠面板

**属性分类**:
1. **基本属性 (Basic)**
   - 名称 (Name)
   - 位置 (X, Y)
   - 尺寸 (Width, Height)
   - 可见性 (Visible)
   - 锁定 (Locked)

2. **外观属性 (Appearance)**
   - 背景色 (Background Color)
   - 背景图片 (Background Image)
   - 边框颜色 (Border Color)
   - 边框宽度 (Border Width)
   - 边框样式 (Border Style: 实线/虚线/点线)
   - 圆角 (Border Radius)
   - 透明度 (Opacity)
   - 阴影 (Shadow)

3. **文本属性 (Text)** (仅文本组件)
   - 字体 (Font Family)
   - 字号 (Font Size)
   - 字体颜色 (Font Color)
   - 字体样式 (Font Style: 加粗/斜体/下划线)
   - 对齐方式 (Text Align: 左/中/右)
   - 行高 (Line Height)

4. **数据属性 (Data)**
   - 数据绑定 (Data Binding)
   - 变量关联 (Variable)
   - 数据格式 (Data Format)
   - 刷新频率 (Refresh Rate)

5. **事件属性 (Events)**
   - 点击事件 (OnClick)
   - 数据变更事件 (OnDataChanged)
   - 鼠标悬停事件 (OnHover)
   - 自定义事件

**交互**:
- 实时更新，修改后立即反映到画布
- 数值输入支持键盘上下键调整
- 颜色选择器支持取色器
- 下拉框支持搜索
- 支持撤销/重做

#### 6.4 图层面板 (Layers Panel)

**功能**: 管理当前页面的图层顺序和显示状态

**内容**:
- 所有组件的层级列表
- 图层缩略图（可选，P2优先级）
- 图层名称
- 图层状态图标（锁定/隐藏）

**交互**:
- 拖拽调整图层顺序
- 锁定/解锁图层
- 显示/隐藏图层
- 点击选中图层
- 框选多个图层

**样式**:
- 列表展示
- 锁定图标: 🔒
- 隐藏图标: 👁️
- 选中高亮

#### 6.5 样式规范
- **宽度**: 280px（可调整，支持拖拽改变宽度）
- **背景**: 白色 #ffffff
- **边框**: 左侧边框 1px solid #d0d0d0
- **内边距**: 12px
- **高度**: 动态（占据左侧导航栏和画布之间的空间）
- **Tab切换**: 垂直Tab，样式与左侧导航栏Tab一致

### 7. 子页面标签栏 (Sub-Page Tabs)

#### 7.1 功能描述
在工程编辑器内打开多个子页面（HMI页面），通过标签页切换。

#### 7.2 标签页样式
- **高度**: 36px
- **标签样式**:
  - 默认: 浅灰背景, 灰色文字
  - 悬停: 中灰背景
  - 激活: 白色背景, 蓝色顶部边框 2px
  - 未保存: 标签页标题旁显示小圆点
- **关闭按钮**: 悬停时显示关闭按钮（×）
- **操作**:
  - 点击切换
  - 点击关闭按钮关闭标签页
  - 右键菜单: 关闭/关闭其他/关闭全部
- **新建标签页**: 最后一个"+"按钮

#### 7.3 标签页位置
位于左侧导航栏和右侧属性栏之间、主内容区顶部，水平排列。

### 8. 主内容区 (Main Content Area)

#### 8.1 功能描述
显示当前子页面的编辑画布。

#### 8.2 画布功能
- **可视化编辑**: 拖拽、调整、旋转、对齐
- **网格背景**: 可配置的网格线
- **标尺**: 水平和垂直标尺
- **缩放**: 支持缩放控制
- **多选**: 框选多个组件
- **对齐辅助**: 吸附、辅助线
- **撤销/重做**: 支持操作历史

#### 8.3 样式规范
- **背景**: 网格背景（可配置）
- **尺寸**: 动态（占据剩余空间）
- **滚动**: 超出可视区域时显示滚动条
- **选中状态**: 显示选中框和调整手柄

### 9. 底部状态栏 (Status Bar)

参考图: `asset/FE-006-底部工具栏-FY.png`, `asset/FE-006-底部工具栏-WPS.png`

#### 9.1 功能分区
状态栏分为多个信息区:

**状态信息区**:
- 就绪: "就绪"
- 操作中: "正在保存..."
- 错误: "错误: xxx"

**缩放控制区**:
- 缩小按钮
- 缩放比例显示 (100%)
- 放大按钮
- 适应窗口按钮

**坐标信息区**:
- 鼠标位置: X: 123, Y: 456
- 选中对象尺寸: W: 200, H: 100

**通知区**:
- 未保存提示: "有未保存的更改"
- 错误提示: "错误: xxx"
- 警告提示: "警告: xxx"

#### 9.2 样式规范
- **高度**: 24px
- **背景**: 略深于主背景 #f0f0f0
- **文字**: 11px 次要文字颜色
- **边框**: 顶部边框 1px solid #d0d0d0
- **分隔**: 各区间使用竖线分隔
- **间距**: 左右内边距 12px

### 10. 组件化和模块化

#### 10.1 组件拆分原则
所有界面元素均采用**组件化、模块化**设计:

**布局组件**:
- `EditorLayout`: 工程编辑器主布局容器（六区域布局）
- `TopToolbar`: 顶部工具导航栏
- `SubToolbar`: 子工具栏
- `LeftSidebar`: 左侧导航栏容器（3个Tab）
- `RightPanel`: 右侧属性栏容器（属性+图层Tab）
- `SubPageTabs`: 子页面标签栏
- `CanvasArea`: 画布内容区
- `StatusBar`: 底部状态栏

**功能组件**:
- `ProjectTab`: 工程标签页
- `ToolbarButton`: 工具栏按钮
- `ToolbarGroup`: 工具栏分组
- `SidebarTab`: 侧边栏Tab
- `ProjectPanel`: 工程面板（树形结构）
- `PagesPanel`: 画面面板（画面列表）
- `ComponentsPanel`: 组件面板（组件库）
- `PropertiesPanel`: 属性面板（右侧）
- `LayersPanel`: 图层面板（右侧）
- `SubPageTab`: 子页面标签页
- `Canvas`: 画布组件
- `ZoomControls`: 缩放控件

**状态管理**:
- `editorStore`: 工程编辑器状态
- `projectStore`: 工程数据状态
- `canvasStore`: 画布状态

#### 10.2 组件通信
- **父 → 子**: Props传递
- **子 → 父**: 回调函数
- **跨组件**: MobX Store全局状态
- **组件间**: 事件总线（Event Bus）或MobX reactions

### 11. 样式一致性

#### 11.1 遵循现有设计系统
所有样式必须遵循 `STYLE_GUIDE.md` 中定义的设计规范:

- **颜色系统**: 使用CSS变量
- **字体系统**: 使用定义的字号层级
- **间距系统**: 8px网格系统
- **组件模式**: 按钮模式、表单控件模式
- **布局标准**: 固定尺寸标准

#### 11.2 新增样式规范
如需新增样式规范，需更新 `STYLE_GUIDE.md` 文档。

## 验收标准

### 功能验收
- [ ] 新建工程后打开新标签页
- [ ] 打开工程后打开新标签页
- [ ] 标签页显示工程名称
- [ ] 支持多标签页切换
- [ ] 支持关闭标签页
- [ ] 工程编辑器六区域布局正确显示
- [ ] 顶部工具栏按钮可点击（当前Mock实现）
- [ ] 左侧导航栏3个Tab可切换（工程、画面、组件）
- [ ] 左侧导航栏各面板显示正确
- [ ] 右侧属性栏默认隐藏，选中对象时显示
- [ ] 右侧属性栏包含属性和图层2个Tab
- [ ] 子页面标签栏显示正常
- [ ] 底部状态栏信息正确显示

### 视觉验收
- [ ] 整体布局协调，配色和谐
- [ ] 遵循工业设计风格
- [ ] 所有组件样式一致性
- [ ] 工具栏图标清晰可辨
- [ ] 左侧导航栏Tab样式正确
- [ ] 右侧属性栏Tab样式正确
- [ ] 子页面标签页样式正确
- [ ] 状态栏布局合理

### 交互验收
- [ ] 所有按钮有悬停效果
- [ ] Tab切换有视觉反馈
- [ ] 工具栏按钮有按下状态
- [ ] 左侧导航栏宽度可调整（可选）
- [ ] 响应式布局（窗口缩放时适配）

### 技术验收
- [ ] 所有组件采用TypeScript编写
- [ ] 组件拆分合理，职责单一
- [ ] MobX状态管理正确集成
- [ ] CSS遵循BEM命名规范
- [ ] 使用CSS变量定义样式
- [ ] 组件可复用性良好

## 依赖关系

**前置需求**:
- REQ-001: Scada基础主页面框架（已完成）
- FE-005: 自定义TitleBar实现（已完成）

**后置需求**:
- 工程文件读写功能
- 画布交互功能
- 组件拖拽功能
- 属性编辑功能
- 数据绑定功能

**依赖模块**:
- MobX状态管理
- React组件库
- CSS变量系统

## 风险和约束

### 技术风险
1. **组件复杂度**: 工程编辑器组件数量多，需严格控制组件职责划分
2. **状态管理**: 多层级组件状态同步，需合理设计Store结构
3. **性能优化**: 画布渲染性能，需考虑虚拟化、懒加载等技术

### 设计约束
1. **样式约束**: 必须遵循现有STYLE_GUIDE.md规范
2. **布局约束**: 五区域布局固定，不可调整
3. **组件约束**: 所有新组件必须模块化、可复用

### 时间约束
- **第一阶段**: 实现整体布局和组件划分（当前需求）
- **第二阶段**: 实现具体功能交互（后续需求）
- **第三阶段**: 实现画布编辑功能（后续需求）

## 实施计划

### 第一阶段: 布局和组件划分（当前）
**目标**: 实现工程编辑器整体布局和所有组件的骨架

**任务**:
1. 创建工程编辑器布局组件
2. 创建顶部工具栏组件
3. 创建子工具栏组件
4. 创建左侧导航栏组件（含Tab切换）
5. 创建各面板组件（项目、组件、属性、图层、数据）
6. 创建子页面标签栏组件
7. 创建画布区域组件
8. 创建底部状态栏组件
9. 集成MobX状态管理
10. 样式实现和调优

**交付物**:
- 完整的工程编辑器界面
- 所有组件可正常显示
- Tab切换功能正常
- 基础交互可用（Mock数据）

### 第二阶段: 功能实现（后续）
**目标**: 实现具体的编辑功能

**任务**:
1. 工具栏按钮功能实现
2. 左侧导航栏面板功能实现
3. 子页面标签页管理
4. 状态栏信息更新
5. 拖拽、选择、调整等画布交互

### 第三阶段: 高级功能（后续）
**目标**: 实现高级编辑功能

**任务**:
1. 撤销/重做
2. 组件对齐和吸附
3. 数据绑定配置
4. 事件配置
5. 工程保存和加载

## 参考文档

### 设计参考
- 原型图: `asset/FE-006-整体布局的原型图-1.png`
- 工具栏参考: `asset/FE-006-工具栏参考-样式和图标-WPS.png`, `asset/FE-006-工具栏参考-WL.png`
- 左侧导航栏参考: `asset/FE-006-左侧导航栏参考-FY.png.png`
- 底部状态栏参考: `asset/FE-006-底部工具栏-FY.png`, `asset/FE-006-底部工具栏-WPS.png`

### 技术参考
- STYLE_GUIDE.md: Scada样式指南
- FE-001: Scada主页面布局功能
- FE-005: 自定义TitleBar实现

## 变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2026-01-23 | 1.0 | 初始版本 | Claude |
