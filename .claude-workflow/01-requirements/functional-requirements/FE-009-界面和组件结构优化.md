# FE-009: 界面和组件结构优化

## 元数据
- **功能ID**: FE-009
- **来源需求**: REQ-009
- **功能类型**: 功能性
- **优先级**: P0 (关键)
- **状态**: 待设计
- **负责平台**: Scada (组态软件)

## 功能描述

对 Scada 工程编辑器进行全面的界面和组件结构优化，实现：
1. 统一的应用级标签栏系统，支持多标签管理和层级化标签
2. 模块化、可复用的组件架构
3. 灵活的布局系统，支持可配置的编辑选项栏
4. 智能的工具栏交互机制（固定/动态模式）
5. 完整的编辑内容页内部标签管理系统

## 用户故事

作为一名 **组态工程师**
我想要 **统一的标签栏系统和模块化的组件架构**
以便于 **高效地管理多个工程，流畅地进行编辑操作，并享受良好的用户体验**

作为一名 **开发人员**
我想要 **清晰、可复用的组件结构**
以便于 **维护代码、扩展功能、提高开发效率**

## 功能分解

### Scada 平台:

#### 1. 应用级标签栏系统 (FE-009-01)
- [ ] **标签栏布局组件**
  - 左侧：Logo + 应用标题显示
  - 中间：动态标签容器
  - 右侧：窗口控制按钮组（最小化、最大化、关闭）
- [ ] **标签页组件**
  - 支持两种标签类型：首页标签（不可关闭）、工程标签（可关闭）
  - 标签状态样式：选中、未选中、悬浮
  - 标签内容：图标 + 标题 + 关闭按钮
- [ ] **标签管理功能**
  - 创建新标签：打开工程时自动创建
  - 切换标签：点击标签激活对应内容
  - 关闭标签：点击关闭按钮（首页除外）
  - 标签激活逻辑：创建或切换时自动激活

#### 2. 首页主内容区 (FE-009-02)
- [ ] **首页布局容器**
  - 左侧导航侧边栏容器
  - 右侧内容展示容器
  - 响应式布局适配
- [ ] **导航侧边栏组件**
  - 导航选项列表：首页、本地、云端、工具
  - 选项状态：选中、未选中、悬浮
  - 选项点击切换右侧内容
- [ ] **首页内容区组件**
  - "开始"部分：
    - 新建工程按钮
    - 从文件打开工程按钮
    - 复制工程按钮
  - "最近工程"部分：
    - 工程卡片列表
    - 工程信息显示：名称、最后打开时间、路径
    - 点击卡片打开工程
- [ ] **交互逻辑**
  - 点击"新建工程"或"打开工程"后，通过回调创建新标签
  - 点击最近工程卡片，通过回调打开对应工程

#### 3. 工程编辑器主布局 (FE-009-03)
- [ ] **编辑器布局容器**（无左侧导航侧边栏）
  - 顶部：主工具栏区域（32px 高度）
  - 主工具栏下方：子工具栏区域（64px 高度，可配置）
  - 中间：编辑内容区域（flex 自适应）
  - 底部：状态栏区域（24px 高度）
- [ ] **工具栏容器组件**
  - 主工具栏容器
  - 子工具栏容器
  - 支持子工具栏显示/隐藏切换

#### 4. 工具栏交互系统 (FE-009-04)
- [ ] **主工具栏组件**
  - 工具选项按钮组：文件、编辑、视图、工具等
  - 按钮状态：选中、未选中、悬浮、禁用
  - 子工具栏模式切换按钮（固定/动态）
- [ ] **子工具栏组件**
  - 显示当前主工具选项对应的子功能按钮
  - 支持动态内容切换
  - 两种显示模式：
    - **固定模式**：一直显示
    - **动态模式**：选中主工具选项时显示，失去焦点后自动隐藏
- [ ] **工具栏状态管理**
  - 当前选中的主工具选项
  - 当前子工具栏显示模式（固定/动态）
  - 子工具栏显示/隐藏状态

#### 5. 编辑内容区域布局 (FE-009-05)
- [ ] **编辑区域容器**
  - 左侧：编辑选项栏容器（可配置宽度）
  - 右侧：编辑内容页容器（flex 自适应）
- [ ] **编辑选项栏组件**
  - 编辑选项列表：工程、画面、组件
  - 支持两种布局模式：
    - **左侧竖向布局**：选项垂直排列（默认）
    - **顶部横向布局**：选项水平排列
  - 选项状态：选中、未选中、悬浮
  - 选项点击切换右侧配置内容
- [ ] **布局配置**
  - 配置项存储在用户设置中
  - 支持运行时切换布局模式
  - 布局切换动画过渡

#### 6. 编辑内容页内部标签系统 (FE-009-06)
- [ ] **内部标签栏组件**
  - 位置：编辑内容页的顶部
  - 标签内容：图标 + 标题 + 关闭按钮
  - 标签状态：选中、未选中、悬浮
- [ ] **内部标签管理**
  - 创建标签：打开非弹窗编辑内容时自动创建
  - 切换标签：点击标签激活对应内容
  - 关闭标签：点击关闭按钮
  - 关闭后自动切换到其他标签
- [ ] **编辑内容主区域**
  - 根据当前激活的内部标签显示对应内容
  - 支持多种内容类型：画面编辑、组件配置、属性面板等

#### 7. 组件化重构 (FE-009-07)
- [ ] **组件库建立**
  - 应用级组件：TabBar, WindowControls, Logo
  - 布局组件：LayoutContainer, SplitPanel, FlexContainer
  - 功能组件：Toolbar, Sidebar, Panel, Canvas
  - UI组件：Button, Input, Dropdown, Card, IconButton
- [ ] **组件规范**
  - 统一的组件接口规范（props、events、slots）
  - 统一的命名规范（PascalCase for 组件, camelCase for 方法）
  - 统一的文件组织结构（组件文件夹：index.tsx, styles.css, types.ts）
- [ ] **组件配置化**
  - 支持通过配置对象自定义组件行为
  - 支持主题定制
  - 支持布局模式配置

#### 8. 状态管理优化 (FE-009-08)
- [ ] **标签状态管理**
  - 应用级标签状态（TabStore）
    - 标签列表
    - 当前激活标签
    - 标签创建/删除/切换方法
  - 编辑内容页内部标签状态（SubPageTabStore）
    - 内部标签列表
    - 当前激活内部标签
    - 内部标签创建/删除/切换方法
- [ ] **工具栏状态管理**
  - 主工具选项状态
  - 子工具栏显示模式
  - 子工具栏显示/隐藏状态
- [ ] **布局状态管理**
  - 编辑选项栏布局模式（左侧/顶部）
  - 侧边栏折叠/展开状态
  - 用户偏好设置持久化

#### 9. 样式系统统一 (FE-009-09)
- [ ] **遵循 STYLE_GUIDE.md**
  - 使用全局 CSS 变量
  - 遵循 8px 网格系统
  - 统一的颜色、字体、间距规范
- [ ] **组件样式规范**
  - 组件内使用 CSS Modules 或 styled-components
  - 避免样式冲突
  - 支持主题定制

#### 10. 组件及模块规范制定与文档输出 (FE-009-10) ⭐ **新增**
- [ ] **规范文档创建** (`COMPONENT_STANDARDS.md`)
  - **组件设计规范**章节
    - Props 接口规范（命名、类型、默认值、验证）
    - Events 接口规范（命名、参数、类型）
    - Slots 接口规范（命名、作用域）
    - 组件生命周期规范（useEffect、useCallback）
    - 组件状态管理规范（useState、useContext、MobX）
    - 组件通信规范（props、context、event bus）
  - **模块组织规范**章节
    - 目录结构规范（src/components、src/modules、src/stores）
    - 文件命名规范（PascalCase.tsx、camelCase.ts）
    - 模块导入导出规范（named exports、default exports）
    - 模块依赖管理规范（绝对路径、相对路径、循环依赖）
  - **代码编写规范**章节
    - 组件命名规范（PascalCase）
    - 文件命名规范（PascalCase.tsx、kebab-case.css）
    - 变量命名规范（camelCase、UPPER_CASE for constants）
    - 函数命名规范（camelCase、handle* for events）
    - TypeScript 类型定义规范（interface、type、enum）
    - JSDoc 注释规范（组件、函数、复杂类型）
    - 错误处理规范（try-catch、error boundaries）
  - **样式规范**章节
    - CSS Modules 使用规范（`.module.css`、命名约定）
    - 样式变量使用规范（CSS Variables、主题）
    - 响应式设计规范（媒体查询、flex 布局）
    - 样式隔离规范（避免全局污染）
  - **状态管理规范**章节
    - Store 设计规范（单一职责、命名规范）
    - Observable 数据规范（@observable、@computed、@action）
    - Action 定义规范（异步操作、错误处理）
    - Computed 定义规范（派生状态、性能优化）
  - **测试规范**章节
    - 单元测试规范（Jest + React Testing Library）
    - 集成测试规范（测试场景、测试数据）
    - 测试覆盖率要求（行覆盖率 > 80%）
    - 测试命名规范（describe、test、expect）

- [ ] **组件开发模板提供**
  - **函数组件模板** (`templates/FunctionComponent.template.tsx`)
    - Props 接口定义
    - 基础生命周期 hooks
    - CSS Modules 导入
    - JSDoc 注释模板
  - **MobX 组件模板** (`templates/MobxComponent.template.tsx`)
    - observer HOC 应用
    - Store 注入方式
    - Observable 数据使用
  - **Store 模板** (`templates/Store.template.ts`)
    - 类定义和构造函数
    - Observable 字段
    - Action 方法
    - Computed 属性

- [ ] **规范遵循检查清单** (`COMPONENT_CHECKLIST.md`)
  - 组件设计检查项（接口、生命周期、状态管理）
  - 代码质量检查项（命名、注释、类型定义）
  - 样式规范检查项（CSS Modules、主题、响应式）
  - 测试覆盖检查项（单元测试、集成测试、覆盖率）
  - 文档完整性检查项（JSDoc、README、API 文档）

- [ ] **规范集成到开发流程**
  - ESLint 规则配置（推荐规范、强制规范）
  - Prettier 配置（代码格式化）
  - Git Hooks（commit 检查、push 检查）
  - Code Review 检查清单
  - CI/CD 集成（自动化检查）

- [ ] **已有代码重构与规范应用**
  - 按照规范重构 FE-009-01 ~ FE-009-09 的所有组件
  - 更新组件接口以符合规范
  - 补充 JSDoc 注释
  - 优化目录结构和文件组织
  - 添加单元测试覆盖

## 非功能需求

### 性能要求
- 标签切换响应时间 < 100ms
- 组件首次渲染时间 < 500ms
- 大量标签（10+）场景下无明显卡顿
- 内存占用增长 < 50MB (使用 10 个标签后)

### 可维护性要求
- 组件代码行数 < 500 行/组件
- 组件复用率 > 60%
- 代码注释覆盖率 > 80%
- TypeScript 类型覆盖率 100%

### 可扩展性要求
- 支持动态添加新的编辑选项
- 支持自定义标签类型
- 支持插件式组件扩展
- 支持自定义主题

### 兼容性要求
- 保持与现有工程文件格式兼容
- 保持与现有数据结构兼容
- 支持 Windows 10/11
- 支持高分屏（DPI 150%-200%）

## 验收标准

### 功能验收
- [ ] 应用级标签栏正常工作
  - 首页标签默认存在且不可关闭
  - 打开工程时自动创建工程标签
  - 支持标签切换、关闭
  - 标签状态样式正确
- [ ] 首页内容正常显示
  - 左侧导航侧边栏显示正确
  - 右侧内容区显示正确
  - 点击"新建工程"或"打开工程"创建新标签
  - 最近工程列表显示正确
- [ ] 工程编辑器布局正确
  - 主工具栏、子工具栏、编辑区、状态栏位置正确
  - 无左侧导航侧边栏
  - 编辑选项栏显示正确
- [ ] 工具栏交互正常
  - 主工具栏选项切换显示对应子工具栏
  - 子工具栏模式切换正常（固定/动态）
  - 动态模式下失去焦点自动隐藏
- [ ] 编辑内容页内部标签系统正常
  - 打开编辑内容时创建内部标签
  - 支持内部标签切换、关闭
  - 关闭后自动切换到其他标签
- [ ] 编辑选项栏布局配置正常
  - 支持左侧竖向布局
  - 支持顶部横向布局
  - 布局切换流畅

### 组件质量验收
- [ ] 所有组件可独立导入和使用
- [ ] 组件接口清晰，文档完整
- [ ] 组件可配置化（props、配置对象）
- [ ] 组件样式统一，无冲突

### 代码质量验收
- [ ] TypeScript 类型定义完整，无 any 类型
- [ ] 代码注释完整，包含 JSDoc
- [ ] 组件文件组织规范
- [ ] 状态管理清晰，数据流向明确

### 设计规范验收
- [ ] 遵循 STYLE_GUIDE.md 设计规范
- [ ] 使用全局 CSS 变量
- [ ] 遵循 8px 网格系统
- [ ] 统一的颜色、字体、间距

### 组件规范文档验收 ⭐ **新增**
- [ ] `COMPONENT_STANDARDS.md` 文档完整输出
  - 包含组件设计、模块组织、代码编写、样式、状态管理、测试所有规范章节
  - 规范内容清晰、详细、可操作
- [ ] 提供组件开发模板
  - 函数组件模板
  - MobX 组件模板
  - Store 模板
- [ ] 提供规范遵循检查清单
  - `COMPONENT_CHECKLIST.md` 检查清单完整
  - 覆盖所有规范要点
- [ ] 规范集成到开发流程
  - ESLint/Prettier 配置完成
  - Git Hooks 配置完成
  - CI/CD 集成完成
- [ ] 已有代码按规范重构
  - FE-009-01 ~ FE-009-09 所有组件符合规范
  - 代码注释完整
  - 目录结构优化

### 性能验收
- [ ] 标签切换 < 100ms
- [ ] 组件渲染无明显卡顿
- [ ] 内存占用合理，无泄漏

## 关联文档
- **设计方案**: SOL-009 (待创建)
- **实现计划**: IMP-009 (待创建)
- **测试用例**: TC-009 (待创建)
- **设计规范**: platforms/scada/packages/renderer/STYLE_GUIDE.md
- **相关实现**: IMP-006 (工程编辑器布局)

## 依赖关系
- **前置功能**:
  - FE-001: Scada主页面布局功能 ✅ (已实现)
  - FE-005: 自定义标题栏实现 ✅ (已实现)
  - FE-006: 工程编辑器整体布局与组件架构 ✅ (已完成实施计划)
- **后置功能**:
  - 工程保存与自动保存功能
  - 多工程并行编辑
  - 工程模板功能
- **并行功能**: 无

## 技术约束

### 技术栈
- **框架**: React 18.3.1 + TypeScript 5.x
- **状态管理**: MobX 6.12.0
- **桌面框架**: Electron 28
- **构建工具**: Vite 5.4.21
- **样式方案**: CSS Modules + CSS Variables

### 架构约束
- 基于现有 IMP-006 实现进行重构
- 保持 MobX 状态管理架构
- 保持现有组件结构（优化，非重写）
- 保持与现有数据流兼容

### 开发约束
- 开发周期：2-3 周
- 需要全面回归测试
- 需要更新用户文档

## 变更历史
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2026-01-28 | 1.0 | 初始创建 | User |
| 2026-01-28 | 1.1 | 新增 FE-009-10: 组件及模块规范制定与文档输出 | User |
