# FE-007-06: 前端动态界面

## 元数据
- **功能ID**: FE-007-06
- **来源需求**: REQ-007
- **功能类型**: 功能性
- **优先级**: P0 (关键功能)
- **状态**: 待设计
- **负责平台**: Cloud (云平台端)

## 功能描述

### 核心功能
实现根据租户类型、角色权限动态显示/隐藏功能的前端界面系统，降低用户理解复杂度，提升用户体验。

### 技术栈
- **框架**: React 18 + TypeScript
- **状态管理**: MobX (与Scada前端保持一致)
- **UI组件库**: Ant Design / Material-UI
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **权限控制**: 基于MobX Store的权限状态管理

### 动态界面设计原则

#### 原则1：渐进式展示
- **下游终端用户**：只显示基础功能（设备管理、数据查看）
- **集成商**：显示管理功能（子组织管理、客户管理、全局数据）
- **平台超管**：显示所有功能（包括平台配置）

#### 原则2：智能隐藏
- **非集成商类型**：隐藏"归属组织"、"管理组织"等字段
- **未开通下游功能**：隐藏"子组织管理"、"下游客户管理"等功能入口
- **无对应权限**：隐藏功能菜单和操作按钮

#### 原则3：自动填充
- **归属组织**：非集成商用户创建资源时，自动填充为当前用户组织
- **管理组织**：下游用户创建资源时，自动填充为父集成商组织

### 动态界面场景

#### 场景1：设备创建页面
**集成商用户**：
- 显示设备名称、类型、位置等基础字段
- 显示"归属组织"下拉选择（选择下游客户）
- 显示"备注"字段
- 保存时设备归属到选定的下游客户

**下游客户用户**：
- 显示设备名称、类型、位置等基础字段
- 隐藏"归属组织"下拉（自动填充为当前用户组织）
- 显示"备注"字段
- 保存时设备归属到当前用户组织

#### 场景2：用户管理页面
**集成商用户**：
- 显示所有用户列表（包括下游客户的用户）
- 显示"所属组织"列
- 可以查看、编辑、删除任何用户
- 显示"创建用户"按钮

**下游客户用户**：
- 只显示本组织的用户列表
- 不显示"所属组织"列（都是本组织）
- 只能管理本组织用户
- 显示"邀请用户"按钮（而不是"创建用户"）

#### 场景3：侧边栏导航菜单
**集成商用户**：
- 系统设置
- 子组织管理 ⭐
- 账号管理
- 角色管理
- 设备管理
- 数据查看
- 告警管理

**下游客户用户**：
- 系统设置（简化版）
- 账号管理（仅本组织）
- 设备管理
- 数据查看
- 告警管理

#### 场景4：数据统计页面
**集成商用户**：
- 显示"按下游客户分组"的统计图表
- 显示"总览数据"（所有下游汇总）
- 显示"租户筛选器"
- 支持切换到单个下游客户视图

**下游客户用户**：
- 只显示本组织的数据统计
- 不显示"租户筛选器"
- 不显示跨租户对比图表

## 用户故事

**作为一个下游客户用户**
我想要看到一个简洁的界面
以便于我快速理解和使用系统功能

**作为一个集成商**
我想要看到完整的管理功能
以便于我管理我的所有下游客户

**作为产品设计师**
我想要根据用户角色动态调整界面
以便于降低用户的学习成本

## 功能分解

### Cloud前端:
- [ ] **动态菜单系统**
  - [ ] 根据用户角色动态显示/隐藏菜单项
  - [ ] 根据用户权限动态显示/隐藏菜单项
  - [ ] 菜单配置化（JSON配置文件）
  - [ ] 菜单权限验证（前端+后端双重验证）

- [ ] **动态表单系统**
  - [ ] 根据租户类型显示/隐藏表单字段
  - [ ] 根据用户权限显示/隐藏表单字段
  - [ ] 自动填充字段值（归属组织、管理组织）
  - [ ] 表单验证规则动态调整
  - [ ] 字段提示信息根据用户角色定制

- [ ] **动态按钮系统**
  - [ ] 根据操作权限显示/隐藏按钮（新增、编辑、删除）
  - [ ] 按钮禁用状态（权限不足时禁用）
  - [ ] 按钮权限提示（hover提示"您没有权限"）
  - [ ] 批量操作按钮动态显示

- [ ] **动态表格系统**
  - [ ] 根据租户类型显示/隐藏列
  - [ ] 根据用户权限显示/隐藏操作列
  - [ ] 表格数据根据租户过滤
  - [ ] 表格行级权限控制（是否可编辑、删除）

- [ ] **动态统计图表**
  - [ ] 集成商视图：多租户统计图表
  - [ ] 下游客户视图：单租户统计图表
  - [ ] 根据数据权限动态调整图表
  - [ ] 租户筛选器（仅集成商）

- [ ] **界面组件库**
  - [ ] PermissionWrapper（权限包裹组件）
  - [ ] RoleAwareComponent（角色感知组件）
  - [ ] TenantAwareComponent（租户感知组件）
  - [ ] AutoFillField（自动填充字段组件）
  - [ ] DynamicForm（动态表单组件）

### MobX状态管理架构:
- [ ] **AuthStore** - 认证状态管理
  - [ ] currentUser - 当前用户信息
  - [ ] currentTenant - 当前租户信息
  - [ ] userPermissions - 用户权限列表
  - [ ] tenantType - 租户类型（INTEGRATOR/TERMINAL）
  - [ ] actions: login, logout, refreshPermissions

- [ ] **PermissionStore** - 权限状态管理
  - [ ] featurePermissions - 功能权限映射
  - [ ] actionPermissions - 操作权限映射
  - [ ] computed: hasFeaturePermission, hasActionPermission
  - [ ] actions: checkPermission, loadPermissions

- [ ] **UIStore** - UI状态管理
  - [ ] menuConfig - 动态菜单配置
  - [ ] visibleFields - 可见字段配置
  - [ ] activeFilters - 激活的过滤器
  - [ ] actions: updateMenuConfig, toggleFieldVisibility

- [ ] **TenantStore** - 租户状态管理
  - [ ] currentTenant - 当前租户信息
  - [ ] managedTenants - 管理的租户列表（集成商）
  - [ ] tenantFeatures - 租户功能模块
  - [ ] computed: isIntegrator, isTerminal, hasFeature
  - [ ] actions: switchTenant, loadManagedTenants

### 设计规范:
- [ ] **界面简化规则**
  - [ ] 定义不同租户类型的界面布局规则
  - [ ] 定义字段显示/隐藏规则矩阵
  - [ ] 定义功能入口显示规则
  - [ ] 定义自动填充规则文档

- [ ] **用户体验设计**
  - [ ] 下游客户界面：简洁、直观、3步完成操作
  - [ ] 集成商界面：完整、强大、多级管理
  - [ ] 过渡动画：界面切换流畅
  - [ ] 提示信息：清晰、友好

## 非功能需求

### 性能要求
- 界面动态渲染时间 < 100ms
- 菜单权限验证 < 50ms
- 组件懒加载，首屏加载时间 < 2s

### 可用性要求
- 界面简洁，用户5分钟内上手
- 功能入口清晰，不超过3次点击
- 错误提示友好，不使用技术术语
- 支持键盘快捷键

### 可维护性要求
- 组件配置化，不硬编码权限
- 规则文档化，易于理解和修改
- 组件复用性高，减少重复代码

## 验收标准

- [ ] **菜单动态显示**
  - [ ] 集成商登录后显示完整菜单
  - [ ] 下游客户登录后显示简化菜单
  - [ ] 无权限访问的菜单项隐藏
  - [ ] 菜单渲染时间 < 100ms

- [ ] **表单动态显示**
  - [ ] 集成商创建设备时显示"归属组织"字段
  - [ ] 下游客户创建设备时隐藏"归属组织"字段
  - [ ] 非集成商用户自动填充归属组织
  - [ ] 表单验证根据租户类型调整

- [ ] **按钮动态显示**
  - [ ] 有"删除"权限的用户显示"删除"按钮
  - [ ] 无"删除"权限的用户不显示"删除"按钮
  - [ ] 按钮禁用状态正确
  - [ ] hover提示正确显示权限信息

- [ ] **表格动态显示**
  - [ ] 集成商查看用户列表显示"所属组织"列
  - [ ] 下游客户查看用户列表不显示"所属组织"列
  - [ ] 表格数据根据租户正确过滤
  - [ ] 操作列根据权限动态显示

- [ ] **统计图表动态显示**
  - [ ] 集成商显示多租户统计图表
  - [ ] 下游客户显示单租户统计图表
  - [ ] 租户筛选器仅对集成商显示
  - [ ] 图表数据权限正确过滤

- [ ] **界面简化效果**
  - [ ] 下游客户界面简洁（菜单项减少50%）
  - [ ] 集成商界面完整（包含所有管理功能）
  - [ ] 用户5分钟内找到需要的功能
  - [ ] 用户满意度调查 > 4.5/5

## 关联文档
- **设计方案**: SOL-007 (待创建)
- **实现计划**: IMP-007 (待创建)
- **测试用例**: TC-007-06 (待创建)
- **UI设计文档**: ui-design-spec.md (待创建)

## 依赖关系
- **前置功能**:
  - FE-007-01: 多租户组织管理（需要租户类型）
  - FE-007-03: RBAC权限模型（需要权限数据）
- **后置功能**:
  - 所有前端功能（都需要动态界面）
- **并行功能**:
  - FE-007-01, FE-007-02, FE-007-03: 可并行开发

## 变更历史
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2026-01-26 | 1.0 | 初始创建 | Claude Code |
