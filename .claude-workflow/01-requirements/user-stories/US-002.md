# US-002: 工程管理用户故事

## 用户故事信息

**用户故事ID**: US-002
**关联需求**: REQ-002
**关联功能需求**: FE-002
**创建日期**: 2026-01-21
**目标平台**: Scada
**状态**: ⏳ 待实施

## 用户故事

### 故事1: 新建工程

**作为** 一名HMI工程师

**我想要** 创建一个新的HMI工程

**以便于** 开始我的组态设计工作

#### 验收标准

- [ ] **场景1: 创建基础工程**
  - Given 我在Scada主页面
  - When 我点击"新建工程"按钮
  - Then 应该打开"新建工程"对话框
  - And 对话框包含所有必填字段：工程名称、硬件平台、保存位置
  - And 对话框包含可选字段：工程作者、工程描述、工程分类、工程加密

- [ ] **场景2: 填写完整信息**
  - Given "新建工程"对话框已打开
  - When 我填写所有信息：
    * 工程名称: "工厂生产线监控"
    * 工程作者: "张三"
    * 工程描述: "用于监控工厂生产线的HMI界面"
    * 工程分类: "工业监控"
    * 硬件平台: "HMI型号1"
    * 保存位置: "C:\Projects\factory.pant"
  - And 我勾选"工程加密"
  - And 我设置密码为 "admin123"
  - And 我点击"确定"按钮
  - Then 系统应该创建工程文件
  - And 工程应该自动打开进入编辑器
  - And 工程标题栏显示"工厂生产线监控 - PanTools"

- [ ] **场景3: 表单验证**
  - Given "新建工程"对话框已打开
  - When 工程名称字段为空
  - And 我点击"确定"按钮
  - Then 应该显示错误提示："工程名称不能为空"
  - And "确定"按钮应该禁用
  - And 对话框不应该关闭

- [ ] **场景4: 自定义工程分类**
  - Given "新建工程"对话框已打开
  - When 我点击"工程分类"下拉框
  - And 我选择"自定义分类"
  - And 我输入新的分类名称: "能源管理"
  - Then 新分类应该被创建
  - And 新分类应该显示在分类列表中
  - And 工程应该关联到新分类

- [ ] **场景5: 取消创建**
  - Given "新建工程"对话框已打开
  - When 我填写了部分信息
  - And 我点击"取消"按钮或按ESC键
  - Then 对话框应该关闭
  - And 已填写的信息不应该保存
  - And 应该返回到主页面

---

### 故事2: 打开工程

**作为** 一名HMI工程师

**我想要** 打开我之前保存的工程文件

**以便于** 继续我的组态设计工作

#### 验收标准

- [ ] **场景1: 从文件打开**
  - Given 我在Scada主页面
  - When 我点击"从文件打开"按钮
  - Then 应该打开文件选择对话框
  - And 对话框默认显示上次打开的位置
  - And 只显示.pant文件
  - When 我选择一个工程文件
  - And 该工程未加密
  - Then 工程应该加载
  - And 应该进入编辑器界面
  - And 工程标题显示工程名称

- [ ] **场景2: 打开加密工程**
  - Given 我在Scada主页面
  - When 我点击"从文件打开"按钮
  - And 我选择一个加密的工程文件
  - Then 应该弹出"输入密码"对话框
  - And 对话框显示工程名称
  - When 我输入正确的密码
  - And 我点击"确定"
  - Then 工程应该加载
  - And 应该进入编辑器界面

- [ ] **场景3: 密码错误**
  - Given "输入密码"对话框已打开
  - When 我输入错误的密码
  - And 我点击"确定"
  - Then 应该显示错误提示："密码错误，请重试"
  - And 工程不应该打开
  - And 对话框应该保持打开

- [ ] **场景4: 文件损坏**
  - Given 我选择了一个.pant文件
  - When 文件已被损坏或篡改
  - Then 应该显示错误提示："工程文件已损坏，无法打开"
  - And 应该显示错误详情（签名验证失败）
  - And 应该返回到主页面

- [ ] **场景5: 从最近工程打开**
  - Given 我在Scada主页面
  - When "最近工程"列表显示3个工程
  - And 我点击其中一个工程
  - And 该工程未加密
  - Then 工程应该立即打开
  - And 应该进入编辑器界面
  - And 该工程的最后打开时间应该更新

---

### 故事3: 管理最近工程

**作为** 一名HMI工程师

**我想要** 快速访问我最近打开的工程

**以便于** 提高工作效率，快速找到需要的工程

#### 验收标准

- [ ] **场景1: 查看最近工程列表**
  - Given 我在Scada主页面
  - When 我打开主页面
  - Then "最近工程"区域应该显示
  - And 应该以列表形式显示最近打开的工程
  - And 每个列表项应该显示：
    * 工程名称
    * 工程分类标签
    * 最后打开时间（如"2小时前"）
    * 工程保存路径
    * 加密状态图标（如果已加密）

- [ ] **场景2: 按分类筛选**
  - Given "最近工程"列表显示15个工程，分布在3个分类
  - When 我点击"工业监控"分类标签
  - Then 列表应该只显示"工业监控"分类下的工程
  - And "工业监控"标签应该显示高亮状态
  - And 其他分类的工程应该隐藏

- [ ] **场景3: 搜索工程**
  - Given "最近工程"列表显示20个工程
  - When 我在搜索框中输入"工厂"
  - Then 列表应该实时过滤
  - And 只显示工程名称包含"工厂"的工程
  - And 过滤结果应该高亮"工厂"文字

- [ ] **场景4: 排序工程**
  - Given "最近工程"列表显示10个工程
  - When 我点击排序下拉框
  - And 我选择"按名称排序 (A-Z)"
  - Then 列表应该按工程名称字母顺序重新排列
  - When 我选择"按打开时间排序"
  - Then 列表应该按最后打开时间倒序排列

- [ ] **场景5: 右键操作**
  - Given "最近工程"列表显示一个工程
  - When 我右键点击该工程
  - Then 应该显示右键菜单
  - And 菜单包含：打开工程、在文件管理器中显示、从列表中移除、复制工程路径
  - When 我点击"从列表中移除"
  - Then 该工程应该从列表中消失
  - And 工程文件不应该被删除

- [ ] **场景6: 键盘导航**
  - Given "最近工程"列表已显示
  - When 我按向下箭头键
  - Then 焦点应该移动到下一个工程
  - When 我按Enter键
  - Then 应该打开当前焦点的工程
  - When 我按Esc键
  - Then 焦点应该退出列表

---

### 故事4: 工程安全保护

**作为** 一名HMI工程师

**我想要** 保护我的工程文件不被未授权访问

**以便于** 保护我的知识产权和设计成果

#### 验收标准

- [ ] **场景1: 创建加密工程**
  - Given 我正在创建新工程
  - When 我勾选"工程加密"复选框
  - Then 应该显示密码输入框
  - And 应该显示密码强度指示器
  - When 我输入密码 "Secure@123"
  - And 密码强度显示"强"
  - And 我点击"确定"
  - Then 工程文件应该被加密保存
  - And 文件大小应该与明文相近
  - And 工程不应该被其他工具打开

- [ ] **场景2: 打开加密工程**
  - Given 我尝试打开一个加密工程
  - When 工程已加密
  - Then 应该弹出密码输入对话框
  - And 不应该显示工程内容
  - When 我输入错误密码3次
  - Then 应该显示错误提示："密码错误次数过多，请稍后再试"
  - And 对话框应该锁定30秒

- [ ] **场景3: 防篡改验证**
  - Given 我打开一个工程文件
  - When 文件被手动修改
  - Then 应该显示错误提示："工程文件签名验证失败，文件可能已被篡改"
  - And 工程不应该打开
  - And 应该提示用户从备份恢复

---

### 故事5: 密码找回

**作为** 一名HMI工程师

**我想要** 在忘记密码时能够找回或重置工程密码

**以便于** 重新访问我的工程，避免工作成果丢失

#### 验收标准

- [ ] **场景1: 发现忘记密码**
  - Given 我尝试打开一个加密工程
  - When 我想不起密码了
  - And 我尝试了3次都输入错误密码
  - Then 应该显示友好的错误提示："密码错误次数过多"
  - And 应该显示"忘记密码？"帮助链接
  - When 我点击"忘记密码？"链接
  - Then 应该打开密码找回指南页面

- [ ] **场景2: 查看密码找回指南**
  - Given 我打开了密码找回指南页面
  - When 我阅读指南内容
  - Then 应该显示详细的找回步骤：
    * 准备所有权证明材料
    * 联系官方客服
    * 提交解锁请求
    * 等待验证和处理
  - And 应该显示所需材料清单：
    - 购买凭证（订单号或License Key）
    - 注册邮箱
    - 机器指纹
    - 工程文件路径
  - And 应该显示官方联系方式：
    * 客服邮箱
    * 客服电话
    * 在线客服链接

- [ ] **场景3: 提交解锁请求（客服端）**
  - Given 我准备好所有权证明材料
  - When 我联系官方客服
  - And 我提供以下信息：
    * 工程文件（或projectId）
    * 购买凭证：订单号PO20231201001
    * 注册邮箱：user@example.com
    * Machine ID：550e8400-e29b-41d4-a716-446655440000
    * 工程保存路径：C:\Projects\factory.pant
    * 忘记原因说明
  - And 客服验证我的信息真实性
  - And 验证通过
  - Then 客服使用官方解锁工具处理我的请求
  - And 工程密码被移除
  - And 我收到新工程文件或工程文件已更新
  - And 我可以正常打开工程

- [ ] **场景4: 选择重置新密码（可选）**
  - Given 我的解锁请求被批准
  - When 客服询问是否要设置新密码
  - And 我选择"是，设置新密码"
  - And 我提供新密码：NewSecure@456
  - Then 客服使用官方工具重置密码
  - And 工程使用新密码加密
  - And 我收到新工程文件
  - And 我可以使用新密码打开工程

- [ ] **场景5: 查看解锁历史（客服端）**
  - Given 我是官方客服人员
  - When 我登录客服系统
  - And 我查询解锁历史记录
  - Then 应该显示所有解锁操作记录：
    * 时间戳
    * 操作人
    * 工程ID
    * 用户信息
    * 解锁原因
    * 处理结果
  - And 每条记录不可删除（审计要求）

- [ ] **场景6: 批量解锁处理（客服端）**
  - Given 我是官方客服人员
  - When 我收到多个解锁请求
  - And 我将请求整理到CSV文件
  - And 我使用批量处理工具：
    ```bash
    ./password-recovery-tool batch \
      --input-file "requests.csv" \
      --output-file "results.csv"
    ```
  - Then 工具应该批量处理所有请求
  - And 验证每个请求的所有权证明
  - And 生成处理结果报告
  - And 记录所有操作到审计日志

- [ ] **场景7: 安全提醒**
  - Given 我成功找回密码
  - When 官方客服处理完成
  - Then 我应该收到安全提醒：
    * "您的工程密码已被重置，请妥善保管新密码"
    * "建议您将密码记录在安全的密码管理器中"
    * "定期备份您的工程文件"
  - And 工程元数据应该标记"passwordResetAt"字段
  - And 工程操作日志中记录重置操作

---

## 用户画像

### 主要用户: HMI工程师

**基本信息**:
- 姓名: 张三
- 职业: 工业自动化工程师
- 工作经验: 5年HMI开发经验
- 技术能力: 熟悉工业协议、SQL、JavaScript

**工作场景**:
- 需要管理10-20个不同的HMI工程
- 工程按客户或项目分类
- 经常需要在不同工程间切换
- 关注工程文件的知识产权保护

**痛点**:
- 工程数量多，难以快速找到需要的工程
- 担心工程文件被泄露或篡改
- 需要和团队协作管理工程
- 不同版本的工程容易混淆

**期望**:
- 快速检索和筛选工程
- 安全的工程文件保护
- 清晰的工程分类管理
- 直观的最近工程列表

---

## 验收测试计划

### 手动测试用例

| 测试用例ID | 测试场景 | 预期结果 | 优先级 |
|-----------|---------|---------|--------|
| TC-002-01 | 创建新工程 - 所有必填字段 | 工程创建成功 | P0 |
| TC-002-02 | 创建新工程 - 缺少必填字段 | 显示验证错误 | P0 |
| TC-002-03 | 创建新工程 - 自定义分类 | 新分类创建成功 | P1 |
| TC-002-04 | 创建新工程 - 启用加密 | 工程加密保存 | P0 |
| TC-002-05 | 打开工程 - 未加密工程 | 直接打开 | P0 |
| TC-002-06 | 打开工程 - 加密工程（正确密码）| 打开成功 | P0 |
| TC-002-07 | 打开工程 - 加密工程（错误密码）| 显示密码错误 | P0 |
| TC-002-08 | 打开工程 - 文件损坏 | 显示签名验证失败 | P1 |
| TC-002-09 | 最近工程 - 查看列表 | 显示列表视图 | P0 |
| TC-002-10 | 最近工程 - 分类筛选 | 列表正确过滤 | P0 |
| TC-002-11 | 最近工程 - 搜索 | 实时过滤结果 | P1 |
| TC-002-12 | 最近工程 - 排序 | 按选定规则排序 | P1 |
| TC-002-13 | 最近工程 - 右键操作 | 菜单功能正常 | P1 |
| TC-002-14 | 最近工程 - 键盘导航 | 流畅导航 | P2 |
| TC-002-15 | 密码找回 - 查看指南 | 显示完整指南 | P0 |
| TC-002-16 | 密码找回 - 提交解锁请求 | 所有权验证通过 | P0 |
| TC-002-17 | 密码找回 - 移除密码 | 工程成功移除密码 | P0 |
| TC-002-18 | 密码找回 - 重置密码 | 工程成功设置新密码 | P1 |
| TC-002-19 | 密码找回 - 批量处理 | 批量解锁功能正常 | P1 |
| TC-002-20 | 密码找回 - 审计日志 | 解锁操作记录完整 | P0 |

### 自动化测试建议

- [ ] 单元测试: 表单验证逻辑
- [ ] 单元测试: 加密/解密功能
- [ ] 单元测试: 文件签名验证
- [ ] 集成测试: 工程创建和打开流程
- [ ] E2E测试: 完整的用户操作流程

---

## 相关文档

- 原始需求: REQ-002
- 功能需求: FE-002
- 技术方案: SOL-002 (待创建)
- 实施计划: IMP-002 (待创建)

---

**文档版本**: 1.0
**最后更新**: 2026-01-21
